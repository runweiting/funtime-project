import{y as P,z as $,A as s}from"./index-_JC11hTP.js";import{s as y}from"./showSuccessToast-K-RHH7B1.js";import{s as h}from"./showErrorToast-3p2Y-3vb.js";var E={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const f=P.useLoading({}),{VITE_APP_URL:n,VITE_APP_PATH:p}=E,T=$("userOrderStore",{state:()=>({order:{},orderId:"",orders:[],productQtyMap:{}}),actions:{calculateQty(){const r=`${n}/api/${p}/orders`;s.get(r).then(async t=>{const{pagination:c}=t.data,e=c.total_pages,o=Array.from({length:e},(d,a)=>a+1),l=await Promise.all(o.map(async d=>{try{const a=`${r}?page=${d}`;return(await s.get(a)).data.orders}catch{return[]}}));Array.from({length:e},(d,a)=>a+1).forEach(d=>{l[d-1].forEach(i=>{i.products&&typeof i.products=="object"&&Object.values(i.products).forEach(g=>{const u=g.product_id,m=g.qty,_=g.product.short_title;this.productQtyMap[u]||(this.productQtyMap[u]={name:_,productQty:0,orderQty:0}),this.productQtyMap[u].productQty+=m,this.productQtyMap[u].orderQty+=1})})})})},createOrder(r){const t=f.show(),c={data:r},e=`${n}/api/${p}/order`;s.post(e,c).then(o=>{const l=o.data.orderId;this.orderId=l,y(o.data.message),this.getOrder()}).catch(o=>{h(o.data.message)}).finally(()=>{t.hide()})},getOrder(){const r=`${n}/api/${p}/order/${this.orderId}`;s.get(r).then(t=>{this.order=t.data.order}).catch(t=>{h(t.data)})},async getOrders(){const r=`${n}/api/${p}/orders`;try{const t=await s.get(r);this.orders=t.data.orders}catch(t){h(t.data)}},postPay(r){const t=f.show(),c=`${n}/api/${p}/pay/${r}`;s.post(c).then(e=>{y(e.data.message)}).catch(e=>{h(e.data)}).finally(()=>{t.hide()})}}});export{T as u};
