import{C as O,B as P,D as c}from"./index-8_2dSobz.js";import{s as l}from"./showSuccessToast-NlkLUFHd.js";import{s as p}from"./showErrorToast-RmEj-76d.js";var $={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const m=O.useLoading({}),{VITE_APP_URL:n,VITE_APP_PATH:i}=$,I=P("userOrderStore",{state:()=>({orders:[],tempOrderId:"",productQtyMap:{},tempOrder:{}}),actions:{calculateQty(){const e=`${n}/api/${i}/orders`;c.get(e).then(async t=>{const{pagination:r}=t.data,a=r.total_pages,o=Array.from({length:a},(d,s)=>s+1),y=await Promise.all(o.map(async d=>{try{const s=`${e}?page=${d}`;return(await c.get(s)).data.orders}catch{return[]}}));Array.from({length:a},(d,s)=>s+1).forEach(d=>{y[d-1].forEach(u=>{u.products&&typeof u.products=="object"&&Object.values(u.products).forEach(g=>{const h=g.product_id,f=g.qty,_=g.product.short_title;this.productQtyMap[h]||(this.productQtyMap[h]={name:_,productQty:0,orderQty:0}),this.productQtyMap[h].productQty+=f,this.productQtyMap[h].orderQty+=1})})})}).catch(t=>{p(t.response.data.message)})},createOrder(e){const t=m.show(),r={data:e},a=`${n}/api/${i}/order`;c.post(a,r).then(o=>{this.tempOrderId=o.data.orderId,l(o.data.message),this.getOrder(this.tempOrderId)}).catch(o=>{p(o.data.message)}).finally(()=>{t.hide()})},getOrder(e){const t=`${n}/api/${i}/order/${e}`;c.get(t).then(r=>{this.tempOrder=r.data.order}).catch(r=>{p(r.data)})},async getOrders(){const e=`${n}/api/${i}/orders`;try{const t=await c.get(e);this.orders=t.data.orders}catch(t){p(t.data)}},postPay(e){const t=m.show(),r=`${n}/api/${i}/pay/${e}`;c.post(r).then(a=>{l(a.data.message)}).catch(a=>{p(a.response.data.message)}).finally(()=>{t.hide()})}}});export{I as u};
