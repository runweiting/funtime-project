import{y as P,z as $,A as o}from"./index-fCAb3gEa.js";import{s as y}from"./showSuccessToast-LIQr3UAc.js";import{s as n}from"./showErrorToast-_Do5t9Hk.js";var O={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const m=P.useLoading({}),{VITE_APP_URL:p,VITE_APP_PATH:i}=O,I=$("userOrderStore",{state:()=>({order:{},orderId:"",orders:[],productQtyMap:{}}),actions:{calculateQty(){const r=`${p}/api/${i}/orders`;o.get(r).then(async t=>{const{pagination:c}=t.data,e=c.total_pages,s=Array.from({length:e},(d,a)=>a+1),g=await Promise.all(s.map(async d=>{try{const a=`${r}?page=${d}`;return(await o.get(a)).data.orders}catch{return[]}}));Array.from({length:e},(d,a)=>a+1).forEach(d=>{g[d-1].forEach(u=>{u.products&&typeof u.products=="object"&&Object.values(u.products).forEach(l=>{const h=l.product_id,f=l.qty,_=l.product.short_title;this.productQtyMap[h]||(this.productQtyMap[h]={name:_,productQty:0,orderQty:0}),this.productQtyMap[h].productQty+=f,this.productQtyMap[h].orderQty+=1})})})}).catch(t=>{n(t.response.data.message)})},createOrder(r){const t=m.show(),c={data:r},e=`${p}/api/${i}/order`;o.post(e,c).then(s=>{const g=s.data.orderId;this.orderId=g,y(s.data.message),this.getOrder()}).catch(s=>{n(s.data.message)}).finally(()=>{t.hide()})},getOrder(){const r=`${p}/api/${i}/order/${this.orderId}`;o.get(r).then(t=>{this.order=t.data.order}).catch(t=>{n(t.data)})},async getOrders(){const r=`${p}/api/${i}/orders`;try{const t=await o.get(r);this.orders=t.data.orders}catch(t){n(t.data)}},postPay(r){const t=m.show(),c=`${p}/api/${i}/pay/${r}`;o.post(c).then(e=>{y(e.data.message)}).catch(e=>{n(e.response.data.message)}).finally(()=>{t.hide()})}}});export{I as u};
