import{z as I,A as y,m as V,s as L,_ as U,o as d,c as r,a as t,t as n,C as p,J as M,D as h,F as f,u as g,x as S,B as w,L as j,M as R,e as T,r as D,b as E}from"./index-_JC11hTP.js";import{s as P}from"./showSuccessToast-K-RHH7B1.js";import{s as A}from"./showErrorToast-3p2Y-3vb.js";import{t as C}from"./timestampToDate-lwWXufjj.js";import{m as B,P as q}from"./PaginationGroup-vgggwqlx.js";var H={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:x,VITE_APP_PATH:k}=H,O=I({id:"adminOrdersStore",state:()=>({orderList:[],pagination:{},currentPage:null}),actions:{getOrders(o=1){const e=`${x}/api/${k}/admin/orders?page=${o}`;y.get(e).then(u=>{const{orders:b,pagination:s}=u.data,a=b.map(l=>({...l,calculateTotal:this.updateTotal(l)}));this.orderList=a,this.pagination=s,this.currentPage=o}).catch(u=>{A(u.response)})},updateTotal(o){if(!o||!o.products)return 0;let e=0;return Object.values(o.products).forEach(u=>{e+=u.qty*u.product.price}),e},deleteOrder(o,e){const u=`${x}/api/${k}/admin/order/${o}`;y.delete(u).then(b=>{P(b.data.message),this.getOrders(e)})},deleteOrders(){const o=`${x}/api/${k}/admin/orders/all`;y.delete(o).then(e=>{P(e.data.message),this.getOrders()})}}});var N={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:F,VITE_APP_PATH:G}=N,z={props:{currentOrder:Object},data(){return{orderModal:null,tempOrder:{},inputDisabled:!0,subTotal:0}},mixins:[B],created(){this.tempOrder={...this.currentOrder,products:{},user:{email:"",name:"",tel:"",address:""}}},watch:{currentOrder:{deep:!0,handler(o){this.tempOrder=o}}},computed:{...V(O,["currentPage"])},methods:{...L(O,["getOrders","timestampToDate"]),formatDate(o){const{formattedDay:e,formattedDate:u}=C(o);return{formattedDay:e,formattedDate:u}},togglerEdit(){this.inputDisabled=!1,Object.values(this.tempOrder.products).some(e=>e.coupon&&e.coupon.code)?this.subTotal=0:this.updateSubTotal()},updateSubTotal(){let o=0;Object.values(this.tempOrder.products).forEach(e=>{o+=e.qty*e.product.price}),this.subTotal=o},cancelUpdateOrder(){this.subTotal=0,this.inputDisabled=!0},updateOrder(){const o=`${F}/api/${G}/admin/order/${this.tempOrder.id}`;this.axios.put(o,{data:this.tempOrder}).then(e=>{P(e.data.message),this.subTotal=0,this.inputDisabled=!0,this.modal.hide(),this.getOrders(this.currentPage)}).catch(e=>{A(e.response.data.message)})}}},c=o=>(j("data-v-affa3383"),o=o(),R(),o),X={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",ref:"modal"},J={class:"modal-dialog modal-xl modal-dialog-centered"},Q={class:"modal-content"},K={class:"modal-header bg-dark opacity-75 text-white"},W={class:"modal-title",id:"orderModalLabel"},Y=c(()=>t("br",null,null,-1)),Z=c(()=>t("i",{class:"bi bi-x-lg"},null,-1)),$=[Z],tt={class:"modal-body"},et={class:"container-fluid"},st={class:"row mb-5"},ot={class:"border rounded p-2 bg-light"},lt={class:"row mb-2"},dt={class:"col-md-5 d-flex align-items-center gap-3"},rt=c(()=>t("label",{for:"payment",class:"col-form-label"},"付款狀態：",-1)),nt=["disabled"],at=c(()=>t("option",{value:!0}," 已付款 ",-1)),it=c(()=>t("option",{value:!1}," 未付款 ",-1)),ct=[at,it],ut={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},pt={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},_t={class:"col-md-7"},mt={class:"row"},ht={class:"col-md-5"},bt=c(()=>t("h5",null,"訂購資訊",-1)),ft={class:"row mb-2"},gt=c(()=>t("label",{for:"date",class:"col-sm-3 col-form-label"},"建立時間：",-1)),Ot={class:"col-sm-9"},vt=["disabled"],yt={class:"row mb-2"},Tt=c(()=>t("label",{for:"Email",class:"col-sm-3 col-form-label"},"Email：",-1)),xt={class:"col-sm-9"},kt=["disabled"],wt={class:"row mb-2"},Pt=c(()=>t("label",{for:"name",class:"col-sm-3 col-form-label"},"收件姓名：",-1)),Dt={class:"col-sm-9"},Et=["disabled"],Vt={class:"row mb-2"},Lt=c(()=>t("label",{for:"tel",class:"col-sm-3 col-form-label"},"聯絡電話：",-1)),Ut={class:"col-sm-9"},St=["disabled"],At={class:"row mb-2"},Ct=c(()=>t("label",{for:"address",class:"col-sm-3 col-form-label"},"收件地址：",-1)),It={class:"col-sm-9"},Mt=["disabled"],jt={class:"row mb-2"},Rt=c(()=>t("label",{for:"note",class:"col-sm-3 col-form-label"},"留言：",-1)),Bt={class:"col-sm-9"},qt=["disabled"],Ht={class:"col-md-7"},Nt=c(()=>t("div",{class:"container"},[t("div",{class:"d-flex justify-content-between"},[t("h5",null,"商品內容")])],-1)),Ft={class:"container table-responsive"},Gt={class:"table table-hover align-middle"},zt=c(()=>t("thead",{class:"table-warning"},[t("tr",{class:"align-middle",style:{height:"48px"}},[t("th",{scope:"col",class:"fw-bold",style:{width:"60%"}},"商品"),t("th",{scope:"col",class:"fw-bold",style:{width:"20%"}},"數量"),t("th",{scope:"col",class:"fw-bold text-end",style:{width:"15%"}},"單價"),t("th",{style:{width:"5%"}})])],-1)),Xt={class:"d-flex align-items-center gap-2"},Jt=["src"],Qt=c(()=>t("br",null,null,-1)),Kt={key:0,class:"text-danger"},Wt={class:"pe-0"},Yt={class:"d-flex justify-content-between align-items-center"},Zt={class:"input-group input-group-sm"},$t=["onUpdate:modelValue","disabled"],te={class:"input-group-text"},ee={class:"text-end"},se={class:"fs-6 mb-0"},oe={class:"text-end p-0"},le=["disabled"],de=c(()=>t("td",null,[T(" 原始金額： "),t("br"),T(" 更新金額： "),t("br"),T(" 折扣金額： ")],-1)),re={class:"text-end text-danger fw-bold"},ne=c(()=>t("br",null,null,-1)),ae=c(()=>t("br",null,null,-1)),ie={key:0},ce={key:1,class:"fw-normal text-dark"},ue=c(()=>t("td",null,null,-1)),pe={class:"modal-footer"};function _e(o,e,u,b,s,a){return d(),r("div",X,[t("div",J,[t("div",Q,[t("div",K,[t("h5",W,[t("span",null,"訂單編號："+n(s.tempOrder.id),1),Y]),t("button",{onClick:e[0]||(e[0]=(...l)=>a.cancelUpdateOrder&&a.cancelUpdateOrder(...l)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},$)]),t("div",tt,[t("div",et,[t("div",st,[t("div",ot,[t("div",lt,[t("div",dt,[rt,t("div",null,[p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.tempOrder.is_paid=l),disabled:s.inputDisabled,class:"form-select",id:"payment"},ct,8,nt),[[M,s.tempOrder.is_paid]])]),s.tempOrder.is_paid?(d(),r("i",ut)):(d(),r("i",pt))]),t("div",_t,[t("button",{onClick:e[2]||(e[2]=(...l)=>a.togglerEdit&&a.togglerEdit(...l)),type:"button",class:"btn btn-warning"},"修改訂單")])])])]),t("div",mt,[t("div",ht,[bt,t("form",null,[t("div",ft,[gt,t("div",Ot,[p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.formatDate(s.tempOrder.create_at).formattedDate=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"date"},null,8,vt),[[h,a.formatDate(s.tempOrder.create_at).formattedDate]])])]),t("div",yt,[Tt,t("div",xt,[p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.tempOrder.user.email=l),disabled:s.inputDisabled,type:"email",class:"form-control",id:"Email"},null,8,kt),[[h,s.tempOrder.user.email]])])]),t("div",wt,[Pt,t("div",Dt,[p(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>s.tempOrder.user.name=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"name"},null,8,Et),[[h,s.tempOrder.user.name]])])]),t("div",Vt,[Lt,t("div",Ut,[p(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.tempOrder.user.tel=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"tel"},null,8,St),[[h,s.tempOrder.user.tel]])])]),t("div",At,[Ct,t("div",It,[p(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.tempOrder.user.address=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"address"},null,8,Mt),[[h,s.tempOrder.user.address]])])]),t("div",jt,[Rt,t("div",Bt,[p(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.tempOrder.user.message=l),disabled:s.inputDisabled,class:"form-control",name:"note",id:"note",cols:"10",rows:"10",style:{height:"100px"}},null,8,qt),[[h,s.tempOrder.user.message]])])])])]),t("div",Ht,[Nt,t("div",Ft,[t("table",Gt,[zt,t("tbody",null,[(d(!0),r(f,null,g(s.tempOrder.products,l=>(d(),r("tr",{key:l.id},[t("td",Xt,[t("img",{src:l.product.imageUrl,class:"rounded order-img"},null,8,Jt),t("div",null,[t("small",null,n(l.product.title),1),Qt,l.coupon?(d(),r("small",Kt,"優惠碼："+n(l.coupon.code)+"、折數："+n(l.coupon.percent)+"%",1)):S("",!0)])]),t("td",Wt,[t("div",Yt,[t("div",Zt,[p(t("input",{"onUpdate:modelValue":_=>l.qty=_,disabled:l.coupon,onClick:e[9]||(e[9]=(..._)=>a.updateSubTotal&&a.updateSubTotal(..._)),type:"number",min:"1",class:"form-control"},null,8,$t),[[h,l.qty]]),t("span",te,n(l.product.unit),1)])])]),t("td",ee,[t("p",se,n(l.product.price)+"元",1)]),t("td",oe,[t("button",{disabled:s.inputDisabled,onClick:e[10]||(e[10]=(..._)=>o.deleteOrder&&o.deleteOrder(..._)),type:"button",class:"btn btn-outline-danger btn-sm py-0",style:{scale:"80%"}}," x ",8,le)])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",null,[t("span",null,n(`總共 ${Object.keys(s.tempOrder.products).length} 項`),1)]),de,t("td",re,[t("span",{class:w({"fw-normal":s.subTotal,"text-dark":s.subTotal,"text-decoration-line-through":s.subTotal})},n(s.tempOrder.calculateTotal)+"元 ",3),ne,t("span",{class:w({"fw-normal":!s.subTotal,"text-dark":!s.subTotal,"text-decoration-line-through":!s.subTotal})},n(s.subTotal)+"元 ",3),ae,Object.values(s.tempOrder.products).some(l=>l.coupon)?(d(),r("span",ie,n(Math.round(s.tempOrder.total))+"元 ",1)):(d(),r("span",ce,"無優惠碼"))]),ue])])])])])])])]),t("div",pe,[t("button",{onClick:e[11]||(e[11]=(...l)=>a.cancelUpdateOrder&&a.cancelUpdateOrder(...l)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{onClick:e[12]||(e[12]=(...l)=>a.updateOrder&&a.updateOrder(...l)),type:"button",class:"btn btn-danger"}," 更新訂單 ")])])])],512)}const me=U(z,[["render",_e],["__scopeId","data-v-affa3383"]]),he={components:{OrderModal:me,PaginationGroup:q},data(){return{title:"訂單列表",tempOrderList:[],selectedOrder:{}}},created(){this.tempOrderList=[...this.orderList]},watch:{orderList:{deep:!0,handler(o){this.tempOrderList=o}}},computed:{...V(O,["orderList","calculateTotal","pagination"])},mounted(){this.getOrders()},methods:{...L(O,["getOrders","deleteOrder","deleteOrders","calculateQty"]),getPages(o){this.getOrders(o)},formatDate(o){const{formattedDate:e,formattedTime:u}=C(o);return{formattedDate:e,formattedTime:u}},checkOrder(o){this.selectedOrder={...o},this.$refs.orderModal.openModal()}}},be={class:"container"},fe={class:"row py-2"},ge={class:"col mt-4 mb-4"},Oe={class:"container py-2"},ve=t("h2",null,"這是訂單頁面",-1),ye={class:"d-flex justify-content-between gap-2 py-2"},Te={class:"p-2 mb-0"},xe={class:"d-flex justify-content-end gap-2"},ke={class:"container"},we={class:"table table-hover"},Pe=t("thead",{class:"table-dark"},[t("tr",{class:"fw-bold"},[t("th",{scope:"col"},"日期"),t("th",{scope:"col"},"序號"),t("th",{scope:"col"},"訂單編號"),t("th",{scope:"col"},"品名"),t("th",{scope:"col"},"數量"),t("th",{scope:"col"},"金額"),t("th",{scope:"col"},"優惠卷"),t("th",{scope:"col"},"訂單狀態"),t("th",{scope:"col"},"付款日期"),t("th")])],-1),De={key:0},Ee=t("td",{colspan:"7"},[t("small",{class:"text-muted"}," 目前沒有任何訂單 ")],-1),Ve=[Ee],Le={class:"d-block"},Ue={class:"text-muted"},Se={key:0},Ae={key:1},Ce={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},Ie={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},Me=t("td",null,null,-1),je={class:"btn-group",role:"group"},Re=["onClick"],Be=["onClick"];function qe(o,e,u,b,s,a){const l=D("order-modal"),_=D("pagination-group");return d(),r("main",be,[t("div",fe,[t("main",ge,[t("div",Oe,[ve,t("div",ye,[t("p",Te,n(`一頁顯示 ${Object.keys(this.tempOrderList).length} 項商品`),1),t("div",xe,[t("button",{onClick:e[0]||(e[0]=(...i)=>o.deleteOrders&&o.deleteOrders(...i)),type:"button",class:"btn btn-danger"}," 刪除全部訂單 ")]),E(l,{ref:"orderModal",currentOrder:s.selectedOrder},null,8,["currentOrder"])])]),t("div",ke,[t("table",we,[Pe,t("tbody",null,[s.tempOrderList?S("",!0):(d(),r("tr",De,Ve)),(d(!0),r(f,null,g(s.tempOrderList,i=>(d(),r("tr",{key:i.title},[t("td",null,[t("span",Le,n(a.formatDate(i.create_at).formattedDate),1),t("small",Ue,n(a.formatDate(i.create_at).formattedTime),1)]),t("td",null,n(i.num),1),t("td",null,n(i.id),1),(d(!0),r(f,null,g(i.products,(m,v)=>(d(),r("td",{key:v},n(m.product.short_title),1))),128)),(d(!0),r(f,null,g(i.products,(m,v)=>(d(),r("td",{key:v},n(m.qty),1))),128)),t("td",null,[Object.values(i.products).some(m=>m.coupon)?(d(),r("span",Se,n(Math.round(i.total)),1)):(d(),r("span",Ae,n(i.calculateTotal),1))]),t("td",null,[i.calculateTotal!==i.total?(d(),r("i",Ce)):(d(),r("i",Ie))]),t("td",{class:w({"text-success":i.is_paid,"text-danger":!i.is_paid})},n(i.is_paid?"已付款":"未付款"),3),Me,t("td",null,[t("div",je,[t("button",{onClick:m=>a.checkOrder(i),type:"button",class:"btn btn-outline-primary btn-sm"},"查看訂單 ",8,Re),t("button",{onClick:m=>o.deleteOrder(i.id),type:"button",class:"btn btn-outline-danger btn-sm"},"刪除 ",8,Be)])])]))),128))])])]),E(_,{pagination:o.pagination,onGetPages:a.getPages},null,8,["pagination","onGetPages"])])])])}const Xe=U(he,[["render",qe]]);export{Xe as default};
