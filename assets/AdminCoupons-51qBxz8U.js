import{I as M,s as w,_ as V,r as h,o as c,c as u,a as e,t as m,z as S,J as T,D as k,b as a,w as f,B as _,m as E,F as I,u as P}from"./index-z0OJsCB6.js";import{c as v}from"./couponsStore-9K3AO9BF.js";import{t as x}from"./timestampToDate-lwWXufjj.js";import{m as L,P as U}from"./Pagination-lSHkRFcs.js";import{s as F}from"./showSuccessToast-1ua892gA.js";import{s as g}from"./showErrorToast-E45Ims8J.js";var N={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:D,VITE_APP_PATH:y}=N,A={props:{currentCoupon:Object,isNew:Boolean},data(){return{couponModal:null,tempCoupon:{},inputDisabled:!0,startDateTimestamp:null,dueDateTimestamp:null}},components:{ErrorMessage:M},mixins:[L],created(){this.tempCoupon={...this.currentCoupon}},watch:{currentCoupon:{deep:!0,handler(s){this.tempCoupon=s}}},methods:{...w(v,["getCoupons"]),onSubmit(){this.updateCoupon(),this.$refs.enabledForm.resetForm(),this.$refs.couponForm.resetForm()},formatDate(s){const{formattedDate:t}=x(s);return{formattedDate:t}},validateDateInput(){const s=Math.floor(Date.parse(this.tempCoupon.start_date)/1e3),t=Math.floor(Date.parse(this.tempCoupon.due_date)/1e3);s>t&&g("啟用日不可大於截止日"),this.startDateTimestamp=s,this.dueDateTimestamp=t},togglerEdit(){this.inputDisabled=!1},cancelUpdate(){this.inputDisabled=!0},updateCoupon(){let s=`${D}/api/${y}/admin/coupon`,t="post";this.isNew||(s=`${D}/api/${y}/admin/coupon/${this.tempCoupon.id}`,t="put"),this.tempCoupon.start_date=this.startDateTimestamp,this.tempCoupon.due_date=this.dueDateTimestamp;const C=this.tempCoupon.is_enabled==="已啟用"?1:0;this.axios[t](s,{data:{...this.tempCoupon,is_enabled:C,percent:parseInt(this.tempCoupon.percent,10)}}).then(b=>{F(b.data.message),this.getCoupons()}).then(()=>{this.inputDisabled=!0,this.modal.hide()}).catch(b=>{g(b.response.data.message)})}}},B={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true",ref:"modal"},q={class:"modal-dialog modal-lg modal-dialog-centered"},j={class:"modal-content"},z={class:"modal-header bg-dark opacity-75 text-white"},R={class:"modal-title",id:"couponModalLabel"},O=e("br",null,null,-1),H=e("i",{class:"bi bi-x-lg"},null,-1),J=[H],X={class:"modal-body"},G={class:"container-fluid"},K={class:"row mb-5"},Q={class:"border rounded p-2 bg-light"},W={key:0,class:"row mb-2"},Y={class:"col-md-6 d-flex align-items-center gap-3"},Z=e("label",{for:"dateInput",class:"col-form-label"},"啟用日期：",-1),$={class:"col-sm-6"},ee={class:"row mb-2"},te={class:"d-flex align-items-center gap-3"},oe=e("label",{for:"enabled",class:"col-form-label"},"啟用狀態：",-1),se={class:"col-sm-6"},le=e("option",{value:"已啟用"}," 已啟用 ",-1),ne=e("option",{value:"未啟用"}," 未啟用 ",-1),ae={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},ie={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},de={class:"col-md-6"},ce={class:"row"},ue={class:"col-md-6"},re=e("h5",null,"優惠卷資訊",-1),pe={class:"row mb-2"},me=e("label",{for:"title",class:"col-sm-4 col-form-label"},"優惠卷標題：",-1),_e={class:"col-sm-8"},be={class:"row mb-2"},he=e("label",{for:"code",class:"col-sm-4 col-form-label"},"優惠卷碼：",-1),fe={class:"col-sm-8"},Ce={class:"row mb-2"},ve=e("label",{for:"percent",class:"col-sm-4 col-form-label"},"折扣百分比：",-1),ge={class:"col-sm-8"},De={class:"col-md-6"},ye=e("h5",null,"修改期限",-1),we={class:"row mb-2"},Ve=e("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"啟用日期：",-1),ke={class:"col-sm-8"},xe={class:"row mb-2"},Me=e("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"截止日期：",-1),Se={class:"col-sm-8"},Te={class:"modal-footer"};function Ee(s,t,C,b,o,l){const r=h("VField"),p=h("ErrorMessage"),i=h("VForm");return c(),u("div",B,[e("div",q,[e("div",j,[e("div",z,[e("h5",R,[e("span",null,"優惠卷ID："+m(o.tempCoupon.id),1),O]),e("button",{onClick:t[0]||(t[0]=(...n)=>l.cancelUpdate&&l.cancelUpdate(...n)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},J)]),e("div",X,[e("div",G,[e("div",K,[e("div",Q,[isNaN(o.tempCoupon.start_date)?k("",!0):(c(),u("div",W,[e("div",Y,[Z,e("div",$,[S(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>l.formatDate(o.tempCoupon.start_date).formattedDate=n),disabled:"",class:"form-control",type:"text",id:"dateInput"},null,512),[[T,l.formatDate(o.tempCoupon.start_date).formattedDate]])])])])),e("div",ee,[a(i,{ref:"enabledForm",onSubmit:l.onSubmit,class:"col-md-6"},{default:f(({errors:n})=>[e("div",te,[oe,e("div",se,[a(r,{modelValue:o.tempCoupon.is_enabled,"onUpdate:modelValue":t[2]||(t[2]=d=>o.tempCoupon.is_enabled=d),rules:"required",class:_([{"is-invalid":n.啟用狀態},"form-select w-100"]),disabled:o.inputDisabled,id:"enabled",name:"啟用狀態",as:"select"},{default:f(()=>[le,ne]),_:2},1032,["modelValue","class","disabled"]),a(p,{name:"啟用狀態",class:"invalid-feedback"})]),o.tempCoupon.is_enabled==="已啟用"?(c(),u("i",ae)):(c(),u("i",ie))])]),_:1},8,["onSubmit"]),e("div",de,[e("button",{onClick:t[3]||(t[3]=(...n)=>l.togglerEdit&&l.togglerEdit(...n)),type:"button",class:"btn btn-warning"},"修改優惠卷")])])])]),e("div",ce,[e("div",ue,[re,a(i,{ref:"couponForm",onSubmit:l.onSubmit},{default:f(({errors:n})=>[e("div",pe,[me,e("div",_e,[a(r,{modelValue:o.tempCoupon.title,"onUpdate:modelValue":t[4]||(t[4]=d=>o.tempCoupon.title=d),modelModifiers:{lazy:!0},rules:"required",class:_([{"is-invalid":n.標題},"form-control"]),disabled:o.inputDisabled,type:"text",id:"title",name:"標題"},null,8,["modelValue","class","disabled"]),a(p,{name:"標題",class:"invalid-feedback"})])]),e("div",be,[he,e("div",fe,[a(r,{modelValue:o.tempCoupon.code,"onUpdate:modelValue":t[5]||(t[5]=d=>o.tempCoupon.code=d),modelModifiers:{lazy:!0},rules:"required",class:_([{"is-invalid":n.優惠卷碼},"form-control"]),disabled:o.inputDisabled,type:"text",id:"code",name:"優惠卷碼"},null,8,["modelValue","class","disabled"]),a(p,{name:"優惠卷碼",class:"invalid-feedback"})])]),e("div",Ce,[ve,e("div",ge,[a(r,{modelValue:o.tempCoupon.percent,"onUpdate:modelValue":t[6]||(t[6]=d=>o.tempCoupon.percent=d),modelModifiers:{lazy:!0},rules:"required",class:_([{"is-invalid":n.折扣},"form-control"]),disabled:o.inputDisabled,type:"text",id:"percent",name:"折扣"},null,8,["modelValue","class","disabled"]),a(p,{name:"折扣",class:"invalid-feedback"})])])]),_:1},8,["onSubmit"])]),e("div",De,[ye,a(i,{ref:"form",onSubmit:l.onSubmit},{default:f(({errors:n})=>[e("div",we,[Ve,e("div",ke,[a(r,{onChange:l.validateDateInput,modelValue:o.tempCoupon.start_date,"onUpdate:modelValue":t[7]||(t[7]=d=>o.tempCoupon.start_date=d),rules:"required",class:_([{"is-invalid":n.啟用日},"form-control"]),disabled:o.inputDisabled,type:"date",id:"dateInput",name:"啟用日"},null,8,["onChange","modelValue","class","disabled"]),a(p,{name:"啟用日",class:"invalid-feedback"})])]),e("div",xe,[Me,e("div",Se,[a(r,{onChange:l.validateDateInput,modelValue:o.tempCoupon.due_date,"onUpdate:modelValue":t[8]||(t[8]=d=>o.tempCoupon.due_date=d),rules:"required",class:_([{"is-invalid":n.截止日},"form-control"]),disabled:o.inputDisabled,type:"date",id:"dateInput",name:"截止日"},null,8,["onChange","modelValue","class","disabled"]),a(p,{name:"截止日",class:"invalid-feedback"})])])]),_:1},8,["onSubmit"])])])])]),e("div",Te,[e("button",{onClick:t[9]||(t[9]=(...n)=>l.cancelUpdate&&l.cancelUpdate(...n)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{onClick:t[10]||(t[10]=(...n)=>l.updateCoupon&&l.updateCoupon(...n)),type:"button",class:"btn btn-danger"}," 確認 ")])])])],512)}const Ie=V(A,[["render",Ee]]),Pe={components:{CouponModal:Ie,Pagination:U},data(){return{title:"訂單列表",tempCouponList:[],selectedCoupon:{},isNew:!1}},created(){this.tempCouponList=[...this.couponList]},watch:{couponList:{deep:!0,handler(s){this.tempCouponList=s}}},computed:{...E(v,["couponList","pagination"])},mounted(){this.getCoupons()},methods:{...w(v,["getCoupons","deleteCoupon"]),formatDate(s){const{formattedDate:t}=x(s);return t},openModal(s,t){s==="new"?(this.selectedCoupon={},this.isNew=!0,this.$refs.couponModal.openModal()):s==="edit"&&(this.selectedCoupon={...t},this.isNew=!1,this.$refs.couponModal.openModal())}}},Le={class:"container"},Ue={class:"row py-2"},Fe={class:"col mt-4 mb-4"},Ne={class:"container py-2"},Ae=e("h2",null,"這是優惠卷頁面",-1),Be={class:"d-flex justify-content-between gap-2 py-2"},qe={class:"p-2 mb-0"},je={class:"d-flex justify-content-end gap-2"},ze={class:"container"},Re={class:"table table-hover"},Oe=e("thead",{class:"table-dark"},[e("tr",{class:"fw-bold"},[e("th",{scope:"col"},"優惠卷標題"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"},"起始日"),e("th",{scope:"col"},"截止日"),e("th",{scope:"col"},"啟用狀態"),e("th")])],-1),He={key:0},Je=e("td",{colspan:"7"},[e("small",{class:"text-muted"}," 目前沒有任何優惠卷 ")],-1),Xe=[Je],Ge={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},Ke={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},Qe={class:"btn-group",role:"group","aria-label":"Basic outlined example"},We=["onClick"],Ye=["onClick"];function Ze(s,t,C,b,o,l){const r=h("coupon-modal"),p=h("Pagination");return c(),u("main",Le,[e("div",Ue,[e("main",Fe,[e("div",Ne,[Ae,e("div",Be,[e("p",qe,m(`一頁顯示 ${Object.keys(this.tempCouponList).length} 項商品`),1),e("div",je,[e("button",{onClick:t[0]||(t[0]=i=>l.openModal("new")),type:"button",class:"btn btn-danger"}," 新增優惠卷 ")]),a(r,{ref:"couponModal",currentCoupon:o.selectedCoupon,"is-new":o.isNew},null,8,["currentCoupon","is-new"])])]),e("div",ze,[e("table",Re,[Oe,e("tbody",null,[o.tempCouponList?k("",!0):(c(),u("tr",He,Xe)),(c(!0),u(I,null,P(o.tempCouponList,i=>(c(),u("tr",{key:i.title},[e("td",null,m(i.title),1),e("td",null,m(i.code),1),e("td",null,m(i.percent),1),e("td",null,m(l.formatDate(i.start_date)),1),e("td",null,m(l.formatDate(i.due_date)),1),e("td",null,[i.is_enabled?(c(),u("i",Ge)):(c(),u("i",Ke))]),e("td",null,[e("div",Qe,[e("button",{onClick:n=>l.openModal("edit",i),type:"button",class:"btn btn-outline-primary btn-sm"}," 編輯 ",8,We),e("button",{onClick:n=>s.deleteCoupon(i.id),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,Ye)])])]))),128))])])]),a(p,{pages:s.pagination,onShowPage:s.getCoupons},null,8,["pages","onShowPage"])])])])}const nt=V(Pe,[["render",Ze]]);export{nt as default};
