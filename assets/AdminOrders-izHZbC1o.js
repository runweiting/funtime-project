import{u as A,v as f,s as D,_ as P,o as i,c,a as e,t as d,x as _,y as I,I as m,F as E,z as V,C as S,A as y,D as C,E as j,e as O,m as M,r as w,b as k}from"./index-M0oz9qzx.js";import{s as T}from"./showSuccessToast-0DvGP33G.js";import{s as U}from"./showErrorToast-4hI6Xoib.js";import{t as L}from"./timestampToDate-lwWXufjj.js";import{m as R,P as B}from"./Pagination-vAK819z3.js";var H={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:g,VITE_APP_PATH:v}=H,x=A("orderStore",{state:()=>({orderList:[],pagination:{}}),actions:{getOrders(l=1){const t=`${g}/api/${v}/admin/orders?page=${l}`;f.get(t).then(u=>{const{orders:h,pagination:s}=u.data,a=h.map(o=>({...o,calculateTotal:this.updateTotal(o)}));this.orderList=a,this.pagination=s}).catch(u=>{U(u.response.data.message)})},updateTotal(l){if(!l||!l.products)return 0;let t=0;return Object.values(l.products).forEach(u=>{t+=u.qty*u.product.price}),t},deleteOrder(l){const t=`${g}/api/${v}/admin/order/${l}`;f.delete(t).then(u=>{T(u.data.message),this.getOrders()})},deleteOrders(){const l=`${g}/api/${v}/admin/orders/all`;f.delete(l).then(t=>{T(t.data.message),this.getOrders()})}}});var q={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:N,VITE_APP_PATH:F}=q,z={props:{currentOrder:Object},data(){return{orderModal:null,tempOrder:{},inputDisabled:!0,subTotal:0}},mixins:[R],created(){this.tempOrder={...this.currentOrder,products:{},user:{email:"",name:"",tel:"",address:""}}},watch:{currentOrder:{deep:!0,handler(l){this.tempOrder=l}}},methods:{...D(x,["getOrders","timestampToDate"]),formatDate(l){const{formattedDay:t,formattedDate:u}=L(l);return{formattedDay:t,formattedDate:u}},togglerEdit(){this.inputDisabled=!1,Object.values(this.tempOrder.products).some(t=>t.coupon&&t.coupon.code)?this.subTotal=0:this.updateSubTotal()},updateSubTotal(){let l=0;Object.values(this.tempOrder.products).forEach(t=>{l+=t.qty*t.product.price}),this.subTotal=l},cancelUpdateOrder(){this.subTotal=0,this.inputDisabled=!0},updateOrder(){const l=`${N}/api/${F}/admin/order/${this.tempOrder.id}`;this.axios.put(l,{data:this.tempOrder}).then(t=>{T(t.data.message),this.subTotal=0,this.inputDisabled=!0,this.modal.hide(),this.getOrders()}).catch(t=>{U(t.response.data.message)})}}},r=l=>(C("data-v-8cd747f0"),l=l(),j(),l),X={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",ref:"modal"},G={class:"modal-dialog modal-xl modal-dialog-centered"},J={class:"modal-content"},K={class:"modal-header bg-dark opacity-75 text-white"},Q={class:"modal-title",id:"orderModalLabel"},W=r(()=>e("br",null,null,-1)),Y=r(()=>e("i",{class:"bi bi-x-lg"},null,-1)),Z=[Y],$={class:"modal-body"},ee={class:"container-fluid"},te={class:"row mb-5"},se={class:"border rounded p-2 bg-light"},oe={class:"row mb-2"},le={class:"col-md-5 d-flex align-items-center gap-3"},de=r(()=>e("label",{for:"payment",class:"col-form-label"},"付款狀態：",-1)),re=["disabled"],ae=r(()=>e("option",{value:!0}," 已付款 ",-1)),ne=r(()=>e("option",{value:!1}," 未付款 ",-1)),ie=[ae,ne],ce={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},ue={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},_e={class:"col-md-7"},pe={class:"row"},me={class:"col-md-5"},he=r(()=>e("h5",null,"訂購資訊",-1)),be={class:"row mb-2"},fe=r(()=>e("label",{for:"date",class:"col-sm-3 col-form-label"},"建立時間：",-1)),Oe={class:"col-sm-9"},ge=["disabled"],ve={class:"row mb-2"},ye=r(()=>e("label",{for:"Email",class:"col-sm-3 col-form-label"},"Email：",-1)),Te={class:"col-sm-9"},xe=["disabled"],we={class:"row mb-2"},ke=r(()=>e("label",{for:"name",class:"col-sm-3 col-form-label"},"收件姓名：",-1)),De={class:"col-sm-9"},Pe=["disabled"],Ee={class:"row mb-2"},Ve=r(()=>e("label",{for:"tel",class:"col-sm-3 col-form-label"},"聯絡電話：",-1)),Se={class:"col-sm-9"},Ue=["disabled"],Le={class:"row mb-2"},Ae=r(()=>e("label",{for:"address",class:"col-sm-3 col-form-label"},"收件地址：",-1)),Ie={class:"col-sm-9"},Ce=["disabled"],je={class:"row mb-2"},Me=r(()=>e("label",{for:"note",class:"col-sm-3 col-form-label"},"留言：",-1)),Re={class:"col-sm-9"},Be=["disabled"],He={class:"col-md-7"},qe=r(()=>e("div",{class:"container"},[e("div",{class:"d-flex justify-content-between"},[e("h5",null,"商品內容")])],-1)),Ne={class:"container table-responsive"},Fe={class:"table table-hover align-middle"},ze=r(()=>e("thead",{class:"table-warning"},[e("tr",{class:"align-middle",style:{height:"48px"}},[e("th",{scope:"col",class:"fw-bold",style:{width:"60%"}},"商品"),e("th",{scope:"col",class:"fw-bold",style:{width:"20%"}},"數量"),e("th",{scope:"col",class:"fw-bold text-end",style:{width:"15%"}},"單價"),e("th",{style:{width:"5%"}})])],-1)),Xe={class:"d-flex align-items-center gap-2"},Ge=["src"],Je=r(()=>e("br",null,null,-1)),Ke={key:0,class:"text-danger"},Qe={class:"pe-0"},We={class:"d-flex justify-content-between align-items-center"},Ye={class:"input-group input-group-sm"},Ze=["onUpdate:modelValue","disabled"],$e={class:"input-group-text"},et={class:"text-end"},tt={class:"fs-6 mb-0"},st={class:"text-end p-0"},ot=["disabled"],lt=r(()=>e("td",null,[O(" 原始金額： "),e("br"),O(" 更新金額： "),e("br"),O(" 折扣金額： ")],-1)),dt={class:"text-end text-danger fw-bold"},rt=r(()=>e("br",null,null,-1)),at=r(()=>e("br",null,null,-1)),nt={key:0},it={key:1,class:"fw-normal text-dark"},ct=r(()=>e("td",null,null,-1)),ut={class:"modal-footer"};function _t(l,t,u,h,s,a){return i(),c("div",X,[e("div",G,[e("div",J,[e("div",K,[e("h5",Q,[e("span",null,"訂單編號："+d(s.tempOrder.id),1),W]),e("button",{onClick:t[0]||(t[0]=(...o)=>a.cancelUpdateOrder&&a.cancelUpdateOrder(...o)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},Z)]),e("div",$,[e("div",ee,[e("div",te,[e("div",se,[e("div",oe,[e("div",le,[de,e("div",null,[_(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.tempOrder.is_paid=o),disabled:s.inputDisabled,class:"form-select",id:"payment"},ie,8,re),[[I,s.tempOrder.is_paid]])]),s.tempOrder.is_paid?(i(),c("i",ce)):(i(),c("i",ue))]),e("div",_e,[e("button",{onClick:t[2]||(t[2]=(...o)=>a.togglerEdit&&a.togglerEdit(...o)),type:"button",class:"btn btn-warning"},"修改訂單")])])])]),e("div",pe,[e("div",me,[he,e("form",null,[e("div",be,[fe,e("div",Oe,[_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>a.formatDate(s.tempOrder.create_at).formattedDate=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"date"},null,8,ge),[[m,a.formatDate(s.tempOrder.create_at).formattedDate]])])]),e("div",ve,[ye,e("div",Te,[_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.tempOrder.user.email=o),disabled:s.inputDisabled,type:"email",class:"form-control",id:"Email"},null,8,xe),[[m,s.tempOrder.user.email]])])]),e("div",we,[ke,e("div",De,[_(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.tempOrder.user.name=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"name"},null,8,Pe),[[m,s.tempOrder.user.name]])])]),e("div",Ee,[Ve,e("div",Se,[_(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.tempOrder.user.tel=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"tel"},null,8,Ue),[[m,s.tempOrder.user.tel]])])]),e("div",Le,[Ae,e("div",Ie,[_(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>s.tempOrder.user.address=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"address"},null,8,Ce),[[m,s.tempOrder.user.address]])])]),e("div",je,[Me,e("div",Re,[_(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=o=>s.tempOrder.user.message=o),disabled:s.inputDisabled,class:"form-control",name:"note",id:"note",cols:"10",rows:"10",style:{height:"100px"}},null,8,Be),[[m,s.tempOrder.user.message]])])])])]),e("div",He,[qe,e("div",Ne,[e("table",Fe,[ze,e("tbody",null,[(i(!0),c(E,null,V(s.tempOrder.products,o=>(i(),c("tr",{key:o.id},[e("td",Xe,[e("img",{src:o.product.imageUrl,class:"rounded order-img"},null,8,Ge),e("div",null,[e("small",null,d(o.product.title),1),Je,o.coupon?(i(),c("small",Ke,"優惠碼："+d(o.coupon.code)+"、折數："+d(o.coupon.percent)+"%",1)):S("",!0)])]),e("td",Qe,[e("div",We,[e("div",Ye,[_(e("input",{"onUpdate:modelValue":p=>o.qty=p,disabled:o.coupon,onClick:t[9]||(t[9]=(...p)=>a.updateSubTotal&&a.updateSubTotal(...p)),type:"number",min:"1",class:"form-control"},null,8,Ze),[[m,o.qty]]),e("span",$e,d(o.product.unit),1)])])]),e("td",et,[e("p",tt,d(o.product.price)+"元",1)]),e("td",st,[e("button",{disabled:s.inputDisabled,onClick:t[10]||(t[10]=(...p)=>l.deleteOrder&&l.deleteOrder(...p)),type:"button",class:"btn btn-outline-danger btn-sm py-0",style:{scale:"80%"}}," x ",8,ot)])]))),128))]),e("tfoot",null,[e("tr",null,[e("td",null,[e("span",null,d(`總共 ${Object.keys(s.tempOrder.products).length} 項`),1)]),lt,e("td",dt,[e("span",{class:y({"fw-normal":s.subTotal,"text-dark":s.subTotal,"text-decoration-line-through":s.subTotal})},d(s.tempOrder.calculateTotal)+"元 ",3),rt,e("span",{class:y({"fw-normal":!s.subTotal,"text-dark":!s.subTotal,"text-decoration-line-through":!s.subTotal})},d(s.subTotal)+"元 ",3),at,Object.values(s.tempOrder.products).some(o=>o.coupon)?(i(),c("span",nt,d(Math.round(s.tempOrder.total))+"元 ",1)):(i(),c("span",it,"無優惠碼"))]),ct])])])])])])])]),e("div",ut,[e("button",{onClick:t[11]||(t[11]=(...o)=>a.cancelUpdateOrder&&a.cancelUpdateOrder(...o)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{onClick:t[12]||(t[12]=(...o)=>a.updateOrder&&a.updateOrder(...o)),type:"button",class:"btn btn-danger"}," 更新訂單 ")])])])],512)}const pt=P(z,[["render",_t],["__scopeId","data-v-8cd747f0"]]),mt={components:{OrderModal:pt,Pagination:B},data(){return{title:"訂單列表",tempOrderList:[],selectedOrder:{}}},created(){this.tempOrderList=[...this.orderList]},watch:{orderList:{deep:!0,handler(l){this.tempOrderList=l}}},computed:{...M(x,["orderList","pagination","calculateTotal"])},mounted(){this.getOrders()},methods:{...D(x,["getOrders","deleteOrder","deleteOrders"]),formatDate(l){const{formattedDate:t,formattedTime:u}=L(l);return{formattedDate:t,formattedTime:u}},checkOrder(l){this.selectedOrder={...l},this.$refs.orderModal.openModal()}}},ht={class:"container"},bt={class:"row py-2"},ft={class:"col mt-4 mb-4"},Ot={class:"container py-2"},gt=e("h2",null,"這是訂單頁面",-1),vt={class:"d-flex justify-content-between gap-2 py-2"},yt={class:"p-2 mb-0"},Tt={class:"d-flex justify-content-end gap-2"},xt={class:"container"},wt={class:"table table-hover"},kt=e("thead",{class:"table-dark"},[e("tr",{class:"fw-bold"},[e("th",{scope:"col"},"日期"),e("th",{scope:"col"},"序號"),e("th",{scope:"col"},"訂單編號"),e("th",{scope:"col"},"品項"),e("th",{scope:"col"},"金額"),e("th",{scope:"col"},"優惠卷"),e("th",{scope:"col"},"訂單狀態"),e("th",{scope:"col"},"付款日期"),e("th")])],-1),Dt={key:0},Pt=e("td",{colspan:"7"},[e("small",{class:"text-muted"}," 目前沒有任何訂單 ")],-1),Et=[Pt],Vt={class:"d-block"},St={class:"text-muted"},Ut={key:0},Lt={key:1},At={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},It={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},Ct=e("td",null,null,-1),jt={class:"btn-group",role:"group","aria-label":"Basic outlined example"},Mt=["onClick"],Rt=["onClick"];function Bt(l,t,u,h,s,a){const o=w("order-modal"),p=w("Pagination");return i(),c("main",ht,[e("div",bt,[e("main",ft,[e("div",Ot,[gt,e("div",vt,[e("p",yt,d(`一頁顯示 ${Object.keys(this.tempOrderList).length} 項商品`),1),e("div",Tt,[e("button",{onClick:t[0]||(t[0]=(...n)=>l.deleteOrders&&l.deleteOrders(...n)),type:"button",class:"btn btn-danger"}," 刪除全部訂單 ")]),k(o,{ref:"orderModal",currentOrder:s.selectedOrder},null,8,["currentOrder"])])]),e("div",xt,[e("table",wt,[kt,e("tbody",null,[s.tempOrderList?S("",!0):(i(),c("tr",Dt,Et)),(i(!0),c(E,null,V(s.tempOrderList,n=>(i(),c("tr",{key:n.title},[e("td",null,[e("span",Vt,d(a.formatDate(n.create_at).formattedDate),1),e("small",St,d(a.formatDate(n.create_at).formattedTime),1)]),e("td",null,d(n.num),1),e("td",null,d(n.id),1),e("td",null,d(Object.keys(n.products).length),1),e("td",null,[Object.values(n.products).some(b=>b.coupon)?(i(),c("span",Ut,d(Math.round(n.total)),1)):(i(),c("span",Lt,d(n.calculateTotal),1))]),e("td",null,[n.calculateTotal!==n.total?(i(),c("i",At)):(i(),c("i",It))]),e("td",{class:y({"text-success":n.is_paid,"text-danger":!n.is_paid})},d(n.is_paid?"已付款":"未付款"),3),Ct,e("td",null,[e("div",jt,[e("button",{onClick:b=>a.checkOrder(n),type:"button",class:"btn btn-outline-primary btn-sm"}," 查看訂單 ",8,Mt),e("button",{onClick:b=>l.deleteOrder(n.id),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,Rt)])])]))),128))])])]),k(p,{pages:l.pagination,onShowPage:l.getOrders},null,8,["pages","onShowPage"])])])])}const Xt=P(mt,[["render",Bt]]);export{Xt as default};
