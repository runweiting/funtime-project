import{O as w,E as P,a as x,_ as M,r as h,o as d,c,b as e,t as p,e as T,v as S,A as v,d as l,w as f,g as N,y as _,m as E,F as L,x as I}from"./index-DW-YAaVl.js";import{c as y}from"./adminCouponsStore-jPObQNYd.js";import{t as k}from"./timestampToDate-lwWXufjj.js";import{m as F,P as A}from"./PaginationGroup-qsJzjgRe.js";import{s as U}from"./showSuccessToast-4Q0mJWPL.js";import{s as C}from"./showErrorToast-3Rr6__rM.js";var $={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};w("isEnabled",o=>typeof o=="boolean"&&(o===!1||o===!0)?!0:"啟用狀態為必填");w("nonNegativeDecimal",o=>{const t=parseFloat(o);return!Number.isNaN(t)&&t>=0&&/^\d+(\.\d{1,2})?$/.test(o)?!0:"請填入非負數且小數點最多到第二位"});const{VITE_APP_URL:V,VITE_APP_PATH:D}=$,R={props:{currentCoupon:Object,isNew:Boolean},data(){return{couponModal:null,tempCoupon:{},startDateTimestamp:null,dueDateTimestamp:null}},components:{ErrorMessage:P},mixins:[F],created(){this.tempCoupon={...this.currentCoupon}},watch:{currentCoupon:{deep:!0,handler(o){this.tempCoupon=o}}},methods:{...x(y,["getCoupons"]),onSubmit(){this.updateCoupon(),this.$refs.enabledForm.resetForm(),this.$refs.couponForm.resetForm()},formatDate(o){const{formattedDate:t}=k(o);return{formattedDate:t}},validateDateInput(){const o=Math.floor(Date.parse(this.tempCoupon.start_date)/1e3),t=Math.floor(Date.parse(this.tempCoupon.due_date)/1e3);o>t&&C("啟用日不可大於截止日"),this.startDateTimestamp=o,this.dueDateTimestamp=t},updateCoupon(){const{percent:o}=this.tempCoupon;if(o<=0){C("折扣不可小於或等於0");return}if(!this.startDateTimestamp||!this.dueDateTimestamp){C("啟用、截止日期為必填");return}let t=`${V}/api/${D}/admin/coupon`,b="post";this.isNew||(t=`${V}/api/${D}/admin/coupon/${this.tempCoupon.id}`,b="put"),this.tempCoupon.start_date=this.startDateTimestamp,this.tempCoupon.due_date=this.dueDateTimestamp;const g=this.tempCoupon.is_enabled==="true"?1:0;this.axios[b](t,{data:{...this.tempCoupon,is_enabled:g,percent:parseInt(this.tempCoupon.percent,10)}}).then(s=>{U(s.data.message),this.getCoupons()}).then(()=>{this.modal.hide()}).catch(s=>{C(s.response.data.message)})}}},j={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true",ref:"modal"},q={class:"modal-dialog modal-lg modal-dialog-centered"},B={class:"modal-content"},G={class:"modal-header bg-dark opacity-75 text-white"},O={class:"modal-title",id:"couponModalLabel"},z=e("br",null,null,-1),H=e("button",{type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},[e("i",{class:"bi bi-x-lg"})],-1),J={class:"modal-body"},K={class:"container-fluid"},Q={class:"row mb-5"},W={class:"border rounded p-2 bg-light"},X={key:0,class:"row mb-2"},Y={class:"col-md-6 d-flex align-items-center gap-3"},Z=e("label",{for:"dateInput",class:"col-form-label"},"啟用日期：",-1),ee={class:"col-sm-6"},te={class:"row mb-2"},oe={class:"d-flex align-items-center gap-3"},se=e("label",{for:"enabled",class:"col-form-label"},"啟用狀態：",-1),ne={class:"col-sm-6"},le=e("option",{value:"true"},"已啟用",-1),ae=e("option",{value:"false"},"未啟用",-1),ie={key:0,class:"text-success bi bi-check-circle-fill",style:{transform:"scale(1.5)"}},de={key:1,class:"text-danger bi bi-x-circle-fill",style:{transform:"scale(1.5)"}},ce={class:"row"},re={class:"col-md-6"},ue=e("h5",null,"優惠卷資訊",-1),pe={class:"row mb-2"},me=e("label",{for:"title",class:"col-sm-4 col-form-label"},"優惠卷標題：",-1),_e={class:"col-sm-8"},he={class:"row mb-2"},be=e("label",{for:"code",class:"col-sm-4 col-form-label"},"優惠卷碼：",-1),fe={class:"col-sm-8"},Ce={class:"row mb-2"},ve=e("label",{for:"percent",class:"col-sm-4 col-form-label"},"折扣百分比：",-1),ge={class:"col-sm-8"},ye={class:"col-md-6"},Ve=e("h5",null,"修改期限",-1),De={class:"row mb-2"},we=e("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"啟用日期：",-1),xe={class:"col-sm-8"},Me={class:"row mb-2"},ke=e("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"截止日期：",-1),Pe={class:"col-sm-8"},Te={class:"modal-footer"},Se=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function Ne(o,t,b,g,s,a){const u=h("VField"),m=h("VForm"),n=h("ErrorMessage");return d(),c("div",j,[e("div",q,[e("div",B,[e("div",G,[e("h5",O,[e("span",null,"優惠卷編號："+p(s.tempCoupon.id),1),z]),H]),e("div",J,[e("div",K,[e("div",Q,[e("div",W,[isNaN(s.tempCoupon.start_date)?v("",!0):(d(),c("div",X,[e("div",Y,[Z,e("div",ee,[T(e("input",{id:"dateInput","onUpdate:modelValue":t[0]||(t[0]=i=>a.formatDate(s.tempCoupon.start_date).formattedDate=i),disabled:"",class:"form-control",type:"text"},null,512),[[S,a.formatDate(s.tempCoupon.start_date).formattedDate]])])])])),e("div",te,[l(m,{ref:"enabledForm",onSubmit:a.onSubmit,class:"col-md-6"},{default:f(()=>[e("div",oe,[se,e("div",ne,[l(u,{id:"enabled",modelValue:s.tempCoupon.is_enabled,"onUpdate:modelValue":t[1]||(t[1]=i=>s.tempCoupon.is_enabled=i),rules:"isEnabled",class:"form-select w-100",name:"啟用狀態",as:"select"},{default:f(()=>[le,ae]),_:1},8,["modelValue"])]),s.tempCoupon.is_enabled==="true"?(d(),c("i",ie)):v("",!0),s.tempCoupon.is_enabled==="false"?(d(),c("i",de)):v("",!0)])]),_:1},8,["onSubmit"])])])]),e("div",ce,[e("div",re,[ue,N(" "+p(s.tempCoupon)+" ",1),l(m,{ref:"couponForm",onSubmit:a.onSubmit},{default:f(({errors:i})=>[e("div",pe,[me,e("div",_e,[l(u,{id:"title",modelValue:s.tempCoupon.title,"onUpdate:modelValue":t[2]||(t[2]=r=>s.tempCoupon.title=r),modelModifiers:{lazy:!0},rules:"required",class:_([{"is-invalid":i.標題},"form-control"]),type:"text",name:"標題"},null,8,["modelValue","class"]),l(n,{name:"標題",class:"invalid-feedback"})])]),e("div",he,[be,e("div",fe,[l(u,{id:"code",modelValue:s.tempCoupon.code,"onUpdate:modelValue":t[3]||(t[3]=r=>s.tempCoupon.code=r),modelModifiers:{lazy:!0},rules:"required",class:_([{"is-invalid":i.優惠卷碼},"form-control"]),type:"text",name:"優惠卷碼"},null,8,["modelValue","class"]),l(n,{name:"優惠卷碼",class:"invalid-feedback"})])]),e("div",Ce,[ve,e("div",ge,[l(u,{id:"percent",modelValue:s.tempCoupon.percent,"onUpdate:modelValue":t[4]||(t[4]=r=>s.tempCoupon.percent=r),modelModifiers:{lazy:!0},rules:"required|nonNegativeDecimal",class:_([{"is-invalid":i.折扣},"form-control"]),type:"text",name:"折扣"},null,8,["modelValue","class"]),l(n,{name:"折扣",class:"invalid-feedback"})])])]),_:1},8,["onSubmit"])]),e("div",ye,[Ve,l(m,{ref:"form",onSubmit:a.onSubmit},{default:f(({errors:i})=>[e("div",De,[we,e("div",xe,[l(u,{id:"dateInput",onChange:a.validateDateInput,modelValue:s.tempCoupon.start_date,"onUpdate:modelValue":t[5]||(t[5]=r=>s.tempCoupon.start_date=r),rules:"required",class:_([{"is-invalid":i.啟用日},"form-control"]),type:"date",name:"啟用日"},null,8,["onChange","modelValue","class"]),l(n,{name:"啟用日",class:"invalid-feedback"})])]),e("div",Me,[ke,e("div",Pe,[l(u,{id:"dateInput",onChange:a.validateDateInput,modelValue:s.tempCoupon.due_date,"onUpdate:modelValue":t[6]||(t[6]=r=>s.tempCoupon.due_date=r),rules:"required",class:_([{"is-invalid":i.截止日},"form-control"]),type:"date",name:"截止日"},null,8,["onChange","modelValue","class"]),l(n,{name:"截止日",class:"invalid-feedback"})])])]),_:1},8,["onSubmit"])])])])]),e("div",Te,[Se,e("button",{onClick:t[7]||(t[7]=(...i)=>a.updateCoupon&&a.updateCoupon(...i)),type:"button",class:"btn btn-danger"},"確認")])])])],512)}const Ee=M(R,[["render",Ne]]),Le={components:{CouponModal:Ee,PaginationGroup:A},data(){return{title:"訂單列表",tempCouponList:[],selectedCoupon:{},isNew:!1}},created(){this.tempCouponList=[...this.couponList]},watch:{couponList:{deep:!0,handler(o){this.tempCouponList=o}}},computed:{...E(y,["couponList","pagination","currentPage"])},mounted(){this.getCoupons()},methods:{...x(y,["getCoupons","deleteCoupon"]),getPages(o){this.getCoupons(o)},formatDate(o){const{formattedDate:t}=k(o);return t},openModal(o,t){o==="new"?(this.selectedCoupon={},this.isNew=!0,this.$refs.couponModal.openModal()):o==="edit"&&(this.selectedCoupon={...t},this.isNew=!1,this.$refs.couponModal.openModal())}}},Ie={class:"container"},Fe={class:"row py-2"},Ae={class:"col mt-4 mb-4"},Ue={class:"container py-2"},$e=e("h2",null,"這是優惠卷頁面",-1),Re={class:"d-flex justify-content-between gap-2 py-2"},je={class:"p-2 mb-0"},qe={class:"d-flex justify-content-end gap-2"},Be={class:"container"},Ge={class:"table table-hover"},Oe=e("thead",{class:"table-dark"},[e("tr",{class:"fw-bold"},[e("th",{scope:"col"},"優惠卷標題"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"},"起始日"),e("th",{scope:"col"},"截止日"),e("th",{scope:"col"},"啟用狀態"),e("th")])],-1),ze={key:0},He=e("td",{colspan:"7"},[e("small",{class:"text-muted"}," 目前沒有任何優惠卷 ")],-1),Je=[He],Ke={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},Qe={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},We={class:"btn-group",role:"group"},Xe=["onClick"],Ye=["onClick"];function Ze(o,t,b,g,s,a){const u=h("CouponModal"),m=h("PaginationGroup");return d(),c("main",Ie,[e("div",Fe,[e("main",Ae,[e("div",Ue,[$e,e("div",Re,[e("p",je,p(`一頁顯示 ${Object.keys(this.tempCouponList).length} 項商品`),1),e("div",qe,[e("button",{onClick:t[0]||(t[0]=n=>a.openModal("new")),type:"button",class:"btn btn-danger"}," 新增優惠卷 ")]),l(u,{ref:"couponModal",currentCoupon:s.selectedCoupon,"is-new":s.isNew},null,8,["currentCoupon","is-new"])])]),e("div",Be,[e("table",Ge,[Oe,e("tbody",null,[s.tempCouponList?v("",!0):(d(),c("tr",ze,Je)),(d(!0),c(L,null,I(s.tempCouponList,n=>(d(),c("tr",{key:n.title},[e("td",null,p(n.title),1),e("td",null,p(n.code),1),e("td",null,p(n.percent),1),e("td",null,p(a.formatDate(n.start_date)),1),e("td",null,p(a.formatDate(n.due_date)),1),e("td",null,[n.is_enabled===!0?(d(),c("i",Ke)):(d(),c("i",Qe))]),e("td",null,[e("div",We,[e("button",{onClick:i=>a.openModal("edit",n),type:"button",class:"btn btn-outline-primary btn-sm"}," 編輯 ",8,Xe),e("button",{onClick:i=>o.deleteCoupon(n.id,o.currentPage),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,Ye)])])]))),128))])])]),l(m,{pagination:o.pagination,onGetPages:a.getPages},null,8,["pagination","onGetPages"])])])])}const at=M(Le,[["render",Ze]]);export{at as default};
