import{C as h,B as l,D as a}from"./index-JVHHjXV0.js";import{s as p}from"./showSuccessToast-vmBLG2Pt.js";import{s as d}from"./showErrorToast-Kzq5RtGu.js";var y={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const n=h.useLoading({}),{VITE_APP_URL:c,VITE_APP_PATH:i}=y,E=l("userOrderStore",{state:()=>({order:{},orderId:"",orders:[],productQtyMap:{}}),actions:{createOrder(r){const t=n.show(),o={data:r},e=`${c}/api/${i}/order`;a.post(e,o).then(s=>{const u=s.data.orderId;this.orderId=u,p(s.data.message),this.getOrder()}).catch(s=>{d(s.data.message)}).finally(()=>{t.hide()})},getOrder(){const r=`${c}/api/${i}/order/${this.orderId}`;a.get(r).then(t=>{this.order=t.data.order}).catch(t=>{d(t.data)})},async getOrders(){const r=`${c}/api/${i}/orders`;try{const t=await a.get(r);this.orders=t.data.orders,this.calculateQty()}catch(t){d(t.data)}},postPay(r){const t=n.show(),o=`${c}/api/${i}/pay/${r}`;a.post(o).then(e=>{p(e.data.message)}).catch(e=>{d(e.data)}).finally(()=>{t.hide()})},calculateQty(){this.orders.forEach(r=>{r.products&&typeof r.products=="object"&&Object.values(r.products).forEach(t=>{const o=t.product_id,{qty:e}=t,s=t.product.short_title;this.productQtyMap[o]||(this.productQtyMap[o]={name:s,productQty:0,orderQty:0}),this.productQtyMap[o].productQty+=e,this.productQtyMap[o].orderQty+=1})})}}});export{E as u};
