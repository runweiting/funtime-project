import{O as w,E as P,a as D,_ as x,r as b,o as d,c,b as e,t as p,e as S,v as N,A as M,d as l,w as f,y as h,m as T,F as E,x as L}from"./index-B3z9oC5M.js";import{c as v}from"./adminCouponsStore-xMoRoT5P.js";import{t as k}from"./timestampToDate-lwWXufjj.js";import{m as I,P as F}from"./PaginationGroup-BqDwXmWO.js";import{s as A}from"./showSuccessToast-cAGz1xrC.js";import{s as g}from"./showErrorToast-hDmZ5gkO.js";var U={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};w("isEnabled",o=>typeof o=="boolean"&&(o===!1||o===!0)?!0:"啟用狀態為必填");w("nonNegativeDecimal",o=>{const t=parseFloat(o);return!Number.isNaN(t)&&t>=0&&/^\d+(\.\d{1,2})?$/.test(o)?!0:"請填入非負數且小數點最多到第二位"});const{VITE_APP_URL:y,VITE_APP_PATH:V}=U,$={props:{currentCoupon:Object,isNew:Boolean},data(){return{couponModal:null,tempCoupon:{},startDateTimestamp:null,dueDateTimestamp:null}},components:{ErrorMessage:P},mixins:[I],created(){this.tempCoupon={...this.currentCoupon}},watch:{currentCoupon:{deep:!0,handler(o){this.tempCoupon=o}}},methods:{...D(v,["getCoupons"]),onSubmit(){this.updateCoupon(),this.$refs.enabledForm.resetForm(),this.$refs.couponForm.resetForm()},formatDate(o){const{formattedDate:t}=k(o);return{formattedDate:t}},validateDateInput(){const o=Math.floor(Date.parse(this.tempCoupon.start_date)/1e3),t=Math.floor(Date.parse(this.tempCoupon.due_date)/1e3);o>t&&g("啟用日不可大於截止日"),this.startDateTimestamp=o,this.dueDateTimestamp=t},updateCoupon(){let o=`${y}/api/${V}/admin/coupon`,t="post";this.isNew||(o=`${y}/api/${V}/admin/coupon/${this.tempCoupon.id}`,t="put"),this.tempCoupon.start_date=this.startDateTimestamp,this.tempCoupon.due_date=this.dueDateTimestamp;const C=this.tempCoupon.is_enabled==="true"?1:0;this.axios[t](o,{data:{...this.tempCoupon,is_enabled:C,percent:parseInt(this.tempCoupon.percent,10)}}).then(m=>{A(m.data.message),this.getCoupons()}).then(()=>{this.modal.hide()}).catch(m=>{g(m.response.data.message)})}}},R={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true",ref:"modal"},j={class:"modal-dialog modal-lg modal-dialog-centered"},q={class:"modal-content"},B={class:"modal-header bg-dark opacity-75 text-white"},G={class:"modal-title",id:"couponModalLabel"},O=e("br",null,null,-1),z=e("button",{type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},[e("i",{class:"bi bi-x-lg"})],-1),H={class:"modal-body"},J={class:"container-fluid"},K={class:"row mb-5"},Q={class:"border rounded p-2 bg-light"},W={key:0,class:"row mb-2"},X={class:"col-md-6 d-flex align-items-center gap-3"},Y=e("label",{for:"dateInput",class:"col-form-label"},"啟用日期：",-1),Z={class:"col-sm-6"},ee={class:"row mb-2"},te={class:"d-flex align-items-center gap-3"},oe=e("label",{for:"enabled",class:"col-form-label"},"啟用狀態：",-1),se={class:"col-sm-6"},ne=e("option",{value:"true"},"已啟用",-1),le=e("option",{value:"false"},"未啟用",-1),ae={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},ie={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},de={class:"row"},ce={class:"col-md-6"},re=e("h5",null,"優惠卷資訊",-1),ue={class:"row mb-2"},pe=e("label",{for:"title",class:"col-sm-4 col-form-label"},"優惠卷標題：",-1),me={class:"col-sm-8"},_e={class:"row mb-2"},he=e("label",{for:"code",class:"col-sm-4 col-form-label"},"優惠卷碼：",-1),be={class:"col-sm-8"},fe={class:"row mb-2"},Ce=e("label",{for:"percent",class:"col-sm-4 col-form-label"},"折扣百分比：",-1),ve={class:"col-sm-8"},ge={class:"col-md-6"},ye=e("h5",null,"修改期限",-1),Ve={class:"row mb-2"},we=e("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"啟用日期：",-1),De={class:"col-sm-8"},xe={class:"row mb-2"},Me=e("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"截止日期：",-1),ke={class:"col-sm-8"},Pe={class:"modal-footer"},Se=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function Ne(o,t,C,m,s,a){const u=b("VField"),_=b("VForm"),n=b("ErrorMessage");return d(),c("div",R,[e("div",j,[e("div",q,[e("div",B,[e("h5",G,[e("span",null,"優惠卷編號："+p(s.tempCoupon.id),1),O]),z]),e("div",H,[e("div",J,[e("div",K,[e("div",Q,[isNaN(s.tempCoupon.start_date)?M("",!0):(d(),c("div",W,[e("div",X,[Y,e("div",Z,[S(e("input",{id:"dateInput","onUpdate:modelValue":t[0]||(t[0]=i=>a.formatDate(s.tempCoupon.start_date).formattedDate=i),disabled:"",class:"form-control",type:"text"},null,512),[[N,a.formatDate(s.tempCoupon.start_date).formattedDate]])])])])),e("div",ee,[l(_,{ref:"enabledForm",onSubmit:a.onSubmit,class:"col-md-6"},{default:f(()=>[e("div",te,[oe,e("div",se,[l(u,{id:"enabled",modelValue:s.tempCoupon.is_enabled,"onUpdate:modelValue":t[1]||(t[1]=i=>s.tempCoupon.is_enabled=i),rules:"isEnabled",class:"form-select w-100",name:"啟用狀態",as:"select"},{default:f(()=>[ne,le]),_:1},8,["modelValue"])]),s.tempCoupon.is_enabled?(d(),c("i",ae)):(d(),c("i",ie))])]),_:1},8,["onSubmit"])])])]),e("div",de,[e("div",ce,[re,l(_,{ref:"couponForm",onSubmit:a.onSubmit},{default:f(({errors:i})=>[e("div",ue,[pe,e("div",me,[l(u,{id:"title",modelValue:s.tempCoupon.title,"onUpdate:modelValue":t[2]||(t[2]=r=>s.tempCoupon.title=r),modelModifiers:{lazy:!0},rules:"required",class:h([{"is-invalid":i.標題},"form-control"]),type:"text",name:"標題"},null,8,["modelValue","class"]),l(n,{name:"標題",class:"invalid-feedback"})])]),e("div",_e,[he,e("div",be,[l(u,{id:"code",modelValue:s.tempCoupon.code,"onUpdate:modelValue":t[3]||(t[3]=r=>s.tempCoupon.code=r),modelModifiers:{lazy:!0},rules:"required",class:h([{"is-invalid":i.優惠卷碼},"form-control"]),type:"text",name:"優惠卷碼"},null,8,["modelValue","class"]),l(n,{name:"優惠卷碼",class:"invalid-feedback"})])]),e("div",fe,[Ce,e("div",ve,[l(u,{id:"percent",modelValue:s.tempCoupon.percent,"onUpdate:modelValue":t[4]||(t[4]=r=>s.tempCoupon.percent=r),modelModifiers:{lazy:!0},rules:"required|nonNegativeDecimal",class:h([{"is-invalid":i.折扣},"form-control"]),type:"text",name:"折扣"},null,8,["modelValue","class"]),l(n,{name:"折扣",class:"invalid-feedback"})])])]),_:1},8,["onSubmit"])]),e("div",ge,[ye,l(_,{ref:"form",onSubmit:a.onSubmit},{default:f(({errors:i})=>[e("div",Ve,[we,e("div",De,[l(u,{id:"dateInput",onChange:a.validateDateInput,modelValue:s.tempCoupon.start_date,"onUpdate:modelValue":t[5]||(t[5]=r=>s.tempCoupon.start_date=r),rules:"required",class:h([{"is-invalid":i.啟用日},"form-control"]),type:"date",name:"啟用日"},null,8,["onChange","modelValue","class"]),l(n,{name:"啟用日",class:"invalid-feedback"})])]),e("div",xe,[Me,e("div",ke,[l(u,{id:"dateInput",onChange:a.validateDateInput,modelValue:s.tempCoupon.due_date,"onUpdate:modelValue":t[6]||(t[6]=r=>s.tempCoupon.due_date=r),rules:"required",class:h([{"is-invalid":i.截止日},"form-control"]),type:"date",name:"截止日"},null,8,["onChange","modelValue","class"]),l(n,{name:"截止日",class:"invalid-feedback"})])])]),_:1},8,["onSubmit"])])])])]),e("div",Pe,[Se,e("button",{onClick:t[7]||(t[7]=(...i)=>a.updateCoupon&&a.updateCoupon(...i)),type:"button",class:"btn btn-danger"},"確認")])])])],512)}const Te=x($,[["render",Ne]]),Ee={components:{CouponModal:Te,PaginationGroup:F},data(){return{title:"訂單列表",tempCouponList:[],selectedCoupon:{},isNew:!1}},created(){this.tempCouponList=[...this.couponList]},watch:{couponList:{deep:!0,handler(o){this.tempCouponList=o}}},computed:{...T(v,["couponList","pagination","currentPage"])},mounted(){this.getCoupons()},methods:{...D(v,["getCoupons","deleteCoupon"]),getPages(o){this.getCoupons(o)},formatDate(o){const{formattedDate:t}=k(o);return t},openModal(o,t){o==="new"?(this.selectedCoupon={},this.isNew=!0,this.$refs.couponModal.openModal()):o==="edit"&&(this.selectedCoupon={...t},this.isNew=!1,this.$refs.couponModal.openModal())}}},Le={class:"container"},Ie={class:"row py-2"},Fe={class:"col mt-4 mb-4"},Ae={class:"container py-2"},Ue=e("h2",null,"這是優惠卷頁面",-1),$e={class:"d-flex justify-content-between gap-2 py-2"},Re={class:"p-2 mb-0"},je={class:"d-flex justify-content-end gap-2"},qe={class:"container"},Be={class:"table table-hover"},Ge=e("thead",{class:"table-dark"},[e("tr",{class:"fw-bold"},[e("th",{scope:"col"},"優惠卷標題"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"},"起始日"),e("th",{scope:"col"},"截止日"),e("th",{scope:"col"},"啟用狀態"),e("th")])],-1),Oe={key:0},ze=e("td",{colspan:"7"},[e("small",{class:"text-muted"}," 目前沒有任何優惠卷 ")],-1),He=[ze],Je={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},Ke={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},Qe={class:"btn-group",role:"group"},We=["onClick"],Xe=["onClick"];function Ye(o,t,C,m,s,a){const u=b("CouponModal"),_=b("PaginationGroup");return d(),c("main",Le,[e("div",Ie,[e("main",Fe,[e("div",Ae,[Ue,e("div",$e,[e("p",Re,p(`一頁顯示 ${Object.keys(this.tempCouponList).length} 項商品`),1),e("div",je,[e("button",{onClick:t[0]||(t[0]=n=>a.openModal("new")),type:"button",class:"btn btn-danger"}," 新增優惠卷 ")]),l(u,{ref:"couponModal",currentCoupon:s.selectedCoupon,"is-new":s.isNew},null,8,["currentCoupon","is-new"])])]),e("div",qe,[e("table",Be,[Ge,e("tbody",null,[s.tempCouponList?M("",!0):(d(),c("tr",Oe,He)),(d(!0),c(E,null,L(s.tempCouponList,n=>(d(),c("tr",{key:n.title},[e("td",null,p(n.title),1),e("td",null,p(n.code),1),e("td",null,p(n.percent),1),e("td",null,p(a.formatDate(n.start_date)),1),e("td",null,p(a.formatDate(n.due_date)),1),e("td",null,[n.is_enabled===!0?(d(),c("i",Je)):(d(),c("i",Ke))]),e("td",null,[e("div",Qe,[e("button",{onClick:i=>a.openModal("edit",n),type:"button",class:"btn btn-outline-primary btn-sm"}," 編輯 ",8,We),e("button",{onClick:i=>o.deleteCoupon(n.id,o.currentPage),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,Xe)])])]))),128))])])]),l(_,{pagination:o.pagination,onGetPages:a.getPages},null,8,["pagination","onGetPages"])])])])}const lt=x(Ee,[["render",Ye]]);export{lt as default};
