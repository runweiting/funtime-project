import{m as T,s as w,_ as D,o as d,c as r,a as t,t as n,z as u,K as E,A as m,F as h,u as f,x as V,y as v,M as S,N as C,e as y,r as x,b as k}from"./index-xBDQSGV2.js";import{a as O,P as L}from"./PaginationGroup-bN6rX2oj.js";import{t as P}from"./timestampToDate-lwWXufjj.js";import{m as M}from"./modalMixin-0FoWIZgv.js";import{s as j}from"./showSuccessToast-rejBPG22.js";import{s as A}from"./showErrorToast-8bqWWuy4.js";var I={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:B,VITE_APP_PATH:N}=I,R={props:{currentOrder:Object},data(){return{orderModal:null,tempOrder:{},inputDisabled:!0,subTotal:0}},mixins:[M],created(){this.tempOrder={...this.currentOrder,products:{},user:{email:"",name:"",tel:"",address:""}}},watch:{currentOrder:{deep:!0,handler(l){this.tempOrder=l}}},computed:{...T(O,["currentPage"])},methods:{...w(O,["getOrders","timestampToDate"]),formatDate(l){const{formattedDay:e,formattedDate:b}=P(l);return{formattedDay:e,formattedDate:b}},togglerEdit(){this.inputDisabled=!1,Object.values(this.tempOrder.products).some(e=>e.coupon&&e.coupon.code)?this.subTotal=0:this.updateSubTotal()},updateSubTotal(){let l=0;Object.values(this.tempOrder.products).forEach(e=>{l+=e.qty*e.product.price}),this.subTotal=l},cancelUpdateOrder(){this.subTotal=0,this.inputDisabled=!0},updateOrder(){const l=`${B}/api/${N}/admin/order/${this.tempOrder.id}`;this.axios.put(l,{data:this.tempOrder}).then(e=>{j(e.data.message),this.subTotal=0,this.inputDisabled=!0,this.modal.hide(),this.getOrders(this.currentPage)}).catch(e=>{A(e.response.data.message)})}}},c=l=>(S("data-v-1eb609fe"),l=l(),C(),l),q={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",ref:"modal"},z={class:"modal-dialog modal-xl modal-dialog-centered"},F={class:"modal-content"},H={class:"modal-header bg-dark opacity-75 text-white"},G={class:"modal-title",id:"orderModalLabel"},K=c(()=>t("br",null,null,-1)),Q=c(()=>t("i",{class:"bi bi-x-lg"},null,-1)),X=[Q],J={class:"modal-body"},W={class:"container-fluid"},Y={class:"row mb-5"},Z={class:"border rounded p-2 bg-light"},$={class:"row mb-2"},tt={class:"col-md-5 d-flex align-items-center gap-3"},et=c(()=>t("label",{for:"payment",class:"col-form-label"},"付款狀態：",-1)),st=["disabled"],ot=c(()=>t("option",{value:!0}," 已付款 ",-1)),lt=c(()=>t("option",{value:!1}," 未付款 ",-1)),dt=[ot,lt],rt={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},nt={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},at={class:"col-md-7"},ct={class:"row"},it={class:"col-md-5"},ut=c(()=>t("h5",null,"訂購資訊",-1)),pt={class:"row mb-2"},_t=c(()=>t("label",{for:"date",class:"col-sm-3 col-form-label"},"建立時間：",-1)),mt={class:"col-sm-9"},bt=["disabled"],ht={class:"row mb-2"},ft=c(()=>t("label",{for:"Email",class:"col-sm-3 col-form-label"},"Email：",-1)),Ot={class:"col-sm-9"},gt=["disabled"],yt={class:"row mb-2"},vt=c(()=>t("label",{for:"name",class:"col-sm-3 col-form-label"},"收件姓名：",-1)),xt={class:"col-sm-9"},kt=["disabled"],Tt={class:"row mb-2"},wt=c(()=>t("label",{for:"tel",class:"col-sm-3 col-form-label"},"聯絡電話：",-1)),Dt={class:"col-sm-9"},Vt=["disabled"],Pt={class:"row mb-2"},Ut=c(()=>t("label",{for:"address",class:"col-sm-3 col-form-label"},"收件地址：",-1)),Et={class:"col-sm-9"},St=["disabled"],Ct={class:"row mb-2"},Lt=c(()=>t("label",{for:"note",class:"col-sm-3 col-form-label"},"留言：",-1)),Mt={class:"col-sm-9"},jt=["disabled"],At={class:"col-md-7"},It=c(()=>t("div",{class:"container"},[t("div",{class:"d-flex justify-content-between"},[t("h5",null,"商品內容")])],-1)),Bt={class:"container table-responsive"},Nt={class:"table table-hover align-middle"},Rt=c(()=>t("thead",{class:"table-warning"},[t("tr",{class:"align-middle",style:{height:"48px"}},[t("th",{scope:"col",class:"fw-bold",style:{width:"60%"}},"商品"),t("th",{scope:"col",class:"fw-bold",style:{width:"20%"}},"數量"),t("th",{scope:"col",class:"fw-bold text-end",style:{width:"15%"}},"單價"),t("th",{style:{width:"5%"}})])],-1)),qt={class:"d-flex align-items-center gap-2"},zt=["src"],Ft=c(()=>t("br",null,null,-1)),Ht={key:0,class:"text-danger"},Gt={class:"pe-0"},Kt={class:"d-flex justify-content-between align-items-center"},Qt={class:"input-group input-group-sm"},Xt=["onUpdate:modelValue","disabled"],Jt={class:"input-group-text"},Wt={class:"text-end"},Yt={class:"fs-6 mb-0"},Zt={class:"text-end p-0"},$t=["disabled"],te=c(()=>t("td",null,[y(" 原始金額： "),t("br"),y(" 更新金額： "),t("br"),y(" 折扣金額： ")],-1)),ee={class:"text-end text-danger fw-bold"},se=c(()=>t("br",null,null,-1)),oe=c(()=>t("br",null,null,-1)),le={key:0},de={key:1,class:"fw-normal text-dark"},re=c(()=>t("td",null,null,-1)),ne={class:"modal-footer"};function ae(l,e,b,U,s,i){return d(),r("div",q,[t("div",z,[t("div",F,[t("div",H,[t("h5",G,[t("span",null,"訂單編號："+n(s.tempOrder.id),1),K]),t("button",{onClick:e[0]||(e[0]=(...o)=>i.cancelUpdateOrder&&i.cancelUpdateOrder(...o)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},X)]),t("div",J,[t("div",W,[t("div",Y,[t("div",Z,[t("div",$,[t("div",tt,[et,t("div",null,[u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>s.tempOrder.is_paid=o),disabled:s.inputDisabled,class:"form-select",id:"payment"},dt,8,st),[[E,s.tempOrder.is_paid]])]),s.tempOrder.is_paid?(d(),r("i",rt)):(d(),r("i",nt))]),t("div",at,[t("button",{onClick:e[2]||(e[2]=(...o)=>i.togglerEdit&&i.togglerEdit(...o)),type:"button",class:"btn btn-warning"},"修改訂單")])])])]),t("div",ct,[t("div",it,[ut,t("form",null,[t("div",pt,[_t,t("div",mt,[u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>i.formatDate(s.tempOrder.create_at).formattedDate=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"date"},null,8,bt),[[m,i.formatDate(s.tempOrder.create_at).formattedDate]])])]),t("div",ht,[ft,t("div",Ot,[u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>s.tempOrder.user.email=o),disabled:s.inputDisabled,type:"email",class:"form-control",id:"Email"},null,8,gt),[[m,s.tempOrder.user.email]])])]),t("div",yt,[vt,t("div",xt,[u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>s.tempOrder.user.name=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"name"},null,8,kt),[[m,s.tempOrder.user.name]])])]),t("div",Tt,[wt,t("div",Dt,[u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>s.tempOrder.user.tel=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"tel"},null,8,Vt),[[m,s.tempOrder.user.tel]])])]),t("div",Pt,[Ut,t("div",Et,[u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>s.tempOrder.user.address=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"address"},null,8,St),[[m,s.tempOrder.user.address]])])]),t("div",Ct,[Lt,t("div",Mt,[u(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=o=>s.tempOrder.user.message=o),disabled:s.inputDisabled,class:"form-control",name:"note",id:"note",cols:"10",rows:"10",style:{height:"100px"}},null,8,jt),[[m,s.tempOrder.user.message]])])])])]),t("div",At,[It,t("div",Bt,[t("table",Nt,[Rt,t("tbody",null,[(d(!0),r(h,null,f(s.tempOrder.products,o=>(d(),r("tr",{key:o.id},[t("td",qt,[t("img",{src:o.product.imageUrl,class:"rounded order-img"},null,8,zt),t("div",null,[t("small",null,n(o.product.title),1),Ft,o.coupon?(d(),r("small",Ht,"優惠碼："+n(o.coupon.code)+"、折數："+n(o.coupon.percent)+"%",1)):V("",!0)])]),t("td",Gt,[t("div",Kt,[t("div",Qt,[u(t("input",{"onUpdate:modelValue":p=>o.qty=p,disabled:o.coupon,onClick:e[9]||(e[9]=(...p)=>i.updateSubTotal&&i.updateSubTotal(...p)),type:"number",min:"1",class:"form-control"},null,8,Xt),[[m,o.qty]]),t("span",Jt,n(o.product.unit),1)])])]),t("td",Wt,[t("p",Yt,n(o.product.price)+"元",1)]),t("td",Zt,[t("button",{disabled:s.inputDisabled,onClick:e[10]||(e[10]=(...p)=>l.deleteOrder&&l.deleteOrder(...p)),type:"button",class:"btn btn-outline-danger btn-sm py-0",style:{scale:"80%"}}," x ",8,$t)])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",null,[t("span",null,n(`總共 ${Object.keys(s.tempOrder.products).length} 項`),1)]),te,t("td",ee,[t("span",{class:v({"fw-normal":s.subTotal,"text-dark":s.subTotal,"text-decoration-line-through":s.subTotal})},n(s.tempOrder.calculateTotal)+"元 ",3),se,t("span",{class:v({"fw-normal":!s.subTotal,"text-dark":!s.subTotal,"text-decoration-line-through":!s.subTotal})},n(s.subTotal)+"元 ",3),oe,Object.values(s.tempOrder.products).some(o=>o.coupon)?(d(),r("span",le,n(Math.round(s.tempOrder.total))+"元 ",1)):(d(),r("span",de,"無優惠碼"))]),re])])])])])])])]),t("div",ne,[t("button",{onClick:e[11]||(e[11]=(...o)=>i.cancelUpdateOrder&&i.cancelUpdateOrder(...o)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{onClick:e[12]||(e[12]=(...o)=>i.updateOrder&&i.updateOrder(...o)),type:"button",class:"btn btn-danger"}," 更新訂單 ")])])])],512)}const ce=D(R,[["render",ae],["__scopeId","data-v-1eb609fe"]]),ie={components:{OrderModal:ce,PaginationGroup:L},data(){return{title:"訂單列表",tempOrderList:[],selectedOrder:{}}},created(){this.tempOrderList=[...this.orderList]},watch:{orderList:{deep:!0,handler(l){this.tempOrderList=l}}},computed:{...T(O,["orderList","calculateTotal","currentPage"])},mounted(){this.getOrders()},methods:{...w(O,["getOrders","deleteOrder","deleteOrders","calculateQty"]),formatDate(l){const{formattedDate:e,formattedTime:b}=P(l);return{formattedDate:e,formattedTime:b}},checkOrder(l){this.selectedOrder={...l},this.$refs.orderModal.openModal()}}},ue={class:"container"},pe={class:"row py-2"},_e={class:"col mt-4 mb-4"},me={class:"container py-2"},be=t("h2",null,"這是訂單頁面",-1),he={class:"d-flex justify-content-between gap-2 py-2"},fe={class:"p-2 mb-0"},Oe={class:"d-flex justify-content-end gap-2"},ge={class:"container"},ye={class:"table table-hover"},ve=t("thead",{class:"table-dark"},[t("tr",{class:"fw-bold"},[t("th",{scope:"col"},"日期"),t("th",{scope:"col"},"序號"),t("th",{scope:"col"},"訂單編號"),t("th",{scope:"col"},"品名"),t("th",{scope:"col"},"數量"),t("th",{scope:"col"},"金額"),t("th",{scope:"col"},"優惠卷"),t("th",{scope:"col"},"訂單狀態"),t("th",{scope:"col"},"付款日期"),t("th")])],-1),xe={key:0},ke=t("td",{colspan:"7"},[t("small",{class:"text-muted"}," 目前沒有任何訂單 ")],-1),Te=[ke],we={class:"d-block"},De={class:"text-muted"},Ve={key:0},Pe={key:1},Ue={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},Ee={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},Se=t("td",null,null,-1),Ce={class:"btn-group",role:"group","aria-label":"Basic outlined example"},Le=["onClick"],Me=["onClick"];function je(l,e,b,U,s,i){const o=x("order-modal"),p=x("pagination-group");return d(),r("main",ue,[t("div",pe,[t("main",_e,[t("div",me,[be,t("div",he,[t("p",fe,n(`一頁顯示 ${Object.keys(this.tempOrderList).length} 項商品`),1),t("div",Oe,[t("button",{onClick:e[0]||(e[0]=(...a)=>l.deleteOrders&&l.deleteOrders(...a)),type:"button",class:"btn btn-danger"}," 刪除全部訂單 ")]),k(o,{ref:"orderModal",currentOrder:s.selectedOrder},null,8,["currentOrder"])])]),t("div",ge,[t("table",ye,[ve,t("tbody",null,[s.tempOrderList?V("",!0):(d(),r("tr",xe,Te)),(d(!0),r(h,null,f(s.tempOrderList,a=>(d(),r("tr",{key:a.title},[t("td",null,[t("span",we,n(i.formatDate(a.create_at).formattedDate),1),t("small",De,n(i.formatDate(a.create_at).formattedTime),1)]),t("td",null,n(a.num),1),t("td",null,n(a.id),1),(d(!0),r(h,null,f(a.products,(_,g)=>(d(),r("td",{key:g},n(_.product.short_title),1))),128)),(d(!0),r(h,null,f(a.products,(_,g)=>(d(),r("td",{key:g},n(_.qty),1))),128)),t("td",null,[Object.values(a.products).some(_=>_.coupon)?(d(),r("span",Ve,n(Math.round(a.total)),1)):(d(),r("span",Pe,n(a.calculateTotal),1))]),t("td",null,[a.calculateTotal!==a.total?(d(),r("i",Ue)):(d(),r("i",Ee))]),t("td",{class:v({"text-success":a.is_paid,"text-danger":!a.is_paid})},n(a.is_paid?"已付款":"未付款"),3),Se,t("td",null,[t("div",Ce,[t("button",{onClick:_=>i.checkOrder(a,this.currentPage),type:"button",class:"btn btn-outline-primary btn-sm"}," 查看訂單 ",8,Le),t("button",{onClick:_=>l.deleteOrder(a.id,l.currentPage),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,Me)])])]))),128))])])]),k(p)])])])}const ze=D(ie,[["render",je]]);export{ze as default};
