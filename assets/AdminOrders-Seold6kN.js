import{B as j,D as x,m as U,a as L,_ as S,o as r,c as d,b as t,t as a,e as p,K as C,v as b,F as f,x as O,A,y as w,M as I,N as R,g as T,r as D,d as E}from"./index-B3z9oC5M.js";import{s as V}from"./showSuccessToast-cAGz1xrC.js";import{s as g}from"./showErrorToast-hDmZ5gkO.js";import{t as M}from"./timestampToDate-lwWXufjj.js";import{m as $,P as B}from"./PaginationGroup-BqDwXmWO.js";var q={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:P,VITE_APP_PATH:k}=q,v=j({id:"adminOrdersStore",state:()=>({orderList:[],pagination:{},currentPage:null}),actions:{getOrders(s=1){const e=`${P}/api/${k}/admin/orders?page=${s}`;x.get(e).then(u=>{const{orders:_,pagination:l}=u.data,i=_.map(o=>({...o,calculateTotal:this.updateTotal(o)}));this.orderList=i,this.pagination=l,this.currentPage=s}).catch(u=>{g(u.response.data.message)})},updateTotal(s){if(!s||!s.products)return 0;let e=0;return Object.values(s.products).forEach(u=>{e+=u.qty*u.product.price}),e},deleteOrder(s,e){const u=`${P}/api/${k}/admin/order/${s}`;x.delete(u).then(_=>{V(_.data.message),this.getOrders(e)}).catch(_=>{g(_.response.data.message)})},deleteOrders(){const s=`${P}/api/${k}/admin/orders/all`;x.delete(s).then(e=>{V(e.data.message),this.getOrders()}).catch(e=>{g(e.response.data.message)})}}});var G={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:H,VITE_APP_PATH:N}=G,F={props:{currentOrder:Object},data(){return{orderModal:null,tempOrder:{},subTotal:0}},mixins:[$],created(){this.tempOrder={...this.currentOrder,products:{},user:{email:"",name:"",tel:"",address:""}}},watch:{currentOrder:{deep:!0,handler(s){this.tempOrder=s}}},mounted(){Object.values(this.tempOrder.products).some(e=>e.coupon&&e.coupon.code)?this.subTotal=0:this.updateSubTotal()},computed:{...U(v,["currentPage"])},methods:{...L(v,["getOrders","timestampToDate"]),formatDate(s){const{formattedDay:e,formattedDate:u}=M(s);return{formattedDay:e,formattedDate:u}},updateSubTotal(){let s=0;Object.values(this.tempOrder.products).forEach(e=>{s+=e.qty*e.product.price}),this.subTotal=s},cancelUpdateOrder(){this.subTotal=0},updateOrder(){const s=`${H}/api/${N}/admin/order/${this.tempOrder.id}`;this.axios.put(s,{data:this.tempOrder}).then(e=>{V(e.data.message),this.subTotal=0,this.modal.hide(),this.getOrders(this.currentPage)}).catch(e=>{g(e.response.data.message)})}}},c=s=>(I("data-v-e2ee47a6"),s=s(),R(),s),z={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",ref:"modal"},K={class:"modal-dialog modal-xl modal-dialog-centered"},Q={class:"modal-content"},J={class:"modal-header bg-dark opacity-75 text-white"},W={class:"modal-title",id:"orderModalLabel"},X=c(()=>t("br",null,null,-1)),Y=c(()=>t("i",{class:"bi bi-x-lg"},null,-1)),Z=[Y],tt={class:"modal-body"},et={class:"container-fluid"},st={class:"row mb-5"},ot={class:"border rounded p-2 bg-light"},lt={class:"row mb-2"},rt={class:"col-md-5 d-flex align-items-center gap-3"},dt=c(()=>t("label",{for:"payment",class:"col-form-label"},"付款狀態：",-1)),at=c(()=>t("option",{value:!0},"已付款",-1)),nt=c(()=>t("option",{value:!1},"未付款",-1)),ct=[at,nt],it={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},ut={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},pt={class:"row"},_t={class:"col-md-5"},mt=c(()=>t("h5",null,"訂購資訊",-1)),ht={class:"row mb-2"},bt=c(()=>t("label",{for:"date",class:"col-sm-3 col-form-label"},"建立時間：",-1)),ft={class:"col-sm-9"},Ot={class:"row mb-2"},gt=c(()=>t("label",{for:"Email",class:"col-sm-3 col-form-label"},"Email：",-1)),vt={class:"col-sm-9"},yt={class:"row mb-2"},xt=c(()=>t("label",{for:"name",class:"col-sm-3 col-form-label"},"收件姓名：",-1)),Tt={class:"col-sm-9"},Pt={class:"row mb-2"},kt=c(()=>t("label",{for:"tel",class:"col-sm-3 col-form-label"},"聯絡電話：",-1)),wt={class:"col-sm-9"},Vt={class:"row mb-2"},Dt=c(()=>t("label",{for:"address",class:"col-sm-3 col-form-label"},"收件地址：",-1)),Et={class:"col-sm-9"},Ut={class:"row mb-2"},Lt=c(()=>t("label",{for:"note",class:"col-sm-3 col-form-label"},"留言：",-1)),St={class:"col-sm-9"},At={class:"col-md-7"},Mt=c(()=>t("div",{class:"container"},[t("div",{class:"d-flex justify-content-between"},[t("h5",null,"商品內容")])],-1)),jt={class:"container table-responsive"},Ct={class:"table table-hover align-middle"},It=c(()=>t("thead",{class:"table-warning"},[t("tr",{class:"align-middle",style:{height:"48px"}},[t("th",{scope:"col",class:"fw-bold",style:{width:"60%"}},"商品"),t("th",{scope:"col",class:"fw-bold",style:{width:"20%"}},"數量"),t("th",{scope:"col",class:"fw-bold text-end",style:{width:"15%"}},"單價"),t("th",{style:{width:"5%"}})])],-1)),Rt={class:"d-flex align-items-center gap-2"},$t=["src"],Bt=c(()=>t("br",null,null,-1)),qt={key:0,class:"text-danger"},Gt={class:"pe-0"},Ht={class:"d-flex justify-content-between align-items-center"},Nt={class:"input-group input-group-sm"},Ft=["onUpdate:modelValue","disabled"],zt={class:"input-group-text"},Kt={class:"text-end"},Qt={class:"fs-6 mb-0"},Jt={class:"text-end p-0"},Wt=c(()=>t("td",null,[T(" 原始金額： "),t("br"),T(" 更新金額： "),t("br"),T(" 折扣金額： ")],-1)),Xt={class:"text-end text-danger fw-bold"},Yt=c(()=>t("br",null,null,-1)),Zt=c(()=>t("br",null,null,-1)),te={key:0},ee={key:1,class:"fw-normal text-dark"},se=c(()=>t("td",null,null,-1)),oe={class:"modal-footer"};function le(s,e,u,_,l,i){return r(),d("div",z,[t("div",K,[t("div",Q,[t("div",J,[t("h5",W,[t("span",null,"訂單編號："+a(l.tempOrder.id),1),X]),t("button",{onClick:e[0]||(e[0]=(...o)=>i.cancelUpdateOrder&&i.cancelUpdateOrder(...o)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},Z)]),t("div",tt,[t("div",et,[t("div",st,[t("div",ot,[t("div",lt,[t("div",rt,[dt,t("div",null,[p(t("select",{id:"payment","onUpdate:modelValue":e[1]||(e[1]=o=>l.tempOrder.is_paid=o),class:"form-select"},ct,512),[[C,l.tempOrder.is_paid]])]),l.tempOrder.is_paid?(r(),d("i",it)):(r(),d("i",ut))])])])]),t("div",pt,[t("div",_t,[mt,t("form",null,[t("div",ht,[bt,t("div",ft,[p(t("input",{id:"date","onUpdate:modelValue":e[2]||(e[2]=o=>i.formatDate(l.tempOrder.create_at).formattedDate=o),type:"text",class:"form-control"},null,512),[[b,i.formatDate(l.tempOrder.create_at).formattedDate]])])]),t("div",Ot,[gt,t("div",vt,[p(t("input",{id:"Email","onUpdate:modelValue":e[3]||(e[3]=o=>l.tempOrder.user.email=o),type:"email",class:"form-control"},null,512),[[b,l.tempOrder.user.email]])])]),t("div",yt,[xt,t("div",Tt,[p(t("input",{id:"name","onUpdate:modelValue":e[4]||(e[4]=o=>l.tempOrder.user.name=o),type:"text",class:"form-control"},null,512),[[b,l.tempOrder.user.name]])])]),t("div",Pt,[kt,t("div",wt,[p(t("input",{id:"tel","onUpdate:modelValue":e[5]||(e[5]=o=>l.tempOrder.user.tel=o),type:"text",class:"form-control"},null,512),[[b,l.tempOrder.user.tel]])])]),t("div",Vt,[Dt,t("div",Et,[p(t("input",{id:"address","onUpdate:modelValue":e[6]||(e[6]=o=>l.tempOrder.user.address=o),type:"text",class:"form-control"},null,512),[[b,l.tempOrder.user.address]])])]),t("div",Ut,[Lt,t("div",St,[p(t("textarea",{id:"note","onUpdate:modelValue":e[7]||(e[7]=o=>l.tempOrder.user.message=o),class:"form-control",name:"note",cols:"10",rows:"10",style:{height:"100px"}},null,512),[[b,l.tempOrder.user.message]])])])])]),t("div",At,[Mt,t("div",jt,[t("table",Ct,[It,t("tbody",null,[(r(!0),d(f,null,O(l.tempOrder.products,o=>(r(),d("tr",{key:o.id},[t("td",Rt,[t("img",{src:o.product.imageUrl,class:"rounded order-img"},null,8,$t),t("div",null,[t("small",null,a(o.product.title),1),Bt,o.coupon?(r(),d("small",qt,"優惠碼："+a(o.coupon.code)+"、折數："+a(o.coupon.percent)+"%",1)):A("",!0)])]),t("td",Gt,[t("div",Ht,[t("div",Nt,[p(t("input",{"onUpdate:modelValue":m=>o.qty=m,disabled:o.coupon,onClick:e[8]||(e[8]=(...m)=>i.updateSubTotal&&i.updateSubTotal(...m)),type:"number",min:"1",class:"form-control"},null,8,Ft),[[b,o.qty]]),t("span",zt,a(o.product.unit),1)])])]),t("td",Kt,[t("p",Qt,a(o.product.price)+"元",1)]),t("td",Jt,[t("button",{onClick:e[9]||(e[9]=(...m)=>s.deleteOrder&&s.deleteOrder(...m)),type:"button",class:"btn btn-outline-danger btn-sm py-0",style:{scale:"80%"}},"x")])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",null,[t("span",null,a(`總共 ${Object.keys(l.tempOrder.products).length} 項`),1)]),Wt,t("td",Xt,[t("span",{class:w({"fw-normal":l.subTotal,"text-dark":l.subTotal,"text-decoration-line-through":l.subTotal})},a(l.tempOrder.calculateTotal)+"元 ",3),Yt,t("span",{class:w({"fw-normal":!l.subTotal,"text-dark":!l.subTotal,"text-decoration-line-through":!l.subTotal})},a(l.subTotal)+"元 ",3),Zt,Object.values(l.tempOrder.products).some(o=>o.coupon)?(r(),d("span",te,a(Math.round(l.tempOrder.total))+"元 ",1)):(r(),d("span",ee,"無優惠碼"))]),se])])])])])])])]),t("div",oe,[t("button",{onClick:e[10]||(e[10]=(...o)=>i.cancelUpdateOrder&&i.cancelUpdateOrder(...o)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消"),t("button",{onClick:e[11]||(e[11]=(...o)=>i.updateOrder&&i.updateOrder(...o)),type:"button",class:"btn btn-danger"},"更新訂單")])])])],512)}const re=S(F,[["render",le],["__scopeId","data-v-e2ee47a6"]]),de={components:{OrderModal:re,PaginationGroup:B},data(){return{title:"訂單列表",tempOrderList:[],selectedOrder:{}}},created(){this.tempOrderList=[...this.orderList]},watch:{orderList:{deep:!0,handler(s){this.tempOrderList=s}}},computed:{...U(v,["orderList","calculateTotal","pagination","currentPage"])},mounted(){this.getOrders()},methods:{...L(v,["getOrders","deleteOrder","deleteOrders","calculateQty"]),getPages(s){this.getOrders(s)},formatDate(s){const{formattedDate:e,formattedTime:u}=M(s);return{formattedDate:e,formattedTime:u}},checkOrder(s){this.selectedOrder={...s},this.$refs.orderModal.openModal()}}},ae={class:"container"},ne={class:"row py-2"},ce={class:"col mt-4 mb-4"},ie={class:"container py-2"},ue=t("h2",null,"這是訂單頁面",-1),pe={class:"d-flex justify-content-between gap-2 py-2"},_e={class:"p-2 mb-0"},me={class:"d-flex justify-content-end gap-2"},he={class:"container"},be={class:"table table-hover"},fe=t("thead",{class:"table-dark"},[t("tr",{class:"fw-bold"},[t("th",{scope:"col"},"日期"),t("th",{scope:"col"},"序號"),t("th",{scope:"col"},"訂單編號"),t("th",{scope:"col"},"品名"),t("th",{scope:"col"},"數量"),t("th",{scope:"col"},"金額"),t("th",{scope:"col"},"優惠卷"),t("th",{scope:"col"},"訂單狀態"),t("th",{scope:"col"},"付款日期"),t("th")])],-1),Oe={key:0},ge=t("td",{colspan:"7"},[t("small",{class:"text-muted"}," 目前沒有任何訂單 ")],-1),ve=[ge],ye={class:"d-block"},xe={class:"text-muted"},Te={key:0},Pe={key:1},ke={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},we={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},Ve=t("td",null,null,-1),De={class:"btn-group",role:"group"},Ee=["onClick"],Ue=["onClick"];function Le(s,e,u,_,l,i){const o=D("OrderModal"),m=D("PaginationGroup");return r(),d("main",ae,[t("div",ne,[t("main",ce,[t("div",ie,[ue,t("div",pe,[t("p",_e,a(`一頁顯示 ${Object.keys(this.tempOrderList).length} 項商品`),1),t("div",me,[t("button",{onClick:e[0]||(e[0]=(...n)=>s.deleteOrders&&s.deleteOrders(...n)),type:"button",class:"btn btn-danger"},"刪除全部訂單")]),E(o,{ref:"orderModal",currentOrder:l.selectedOrder},null,8,["currentOrder"])])]),t("div",he,[t("table",be,[fe,t("tbody",null,[l.tempOrderList?A("",!0):(r(),d("tr",Oe,ve)),(r(!0),d(f,null,O(l.tempOrderList,n=>(r(),d("tr",{key:n.title},[t("td",null,[t("span",ye,a(i.formatDate(n.create_at).formattedDate),1),t("small",xe,a(i.formatDate(n.create_at).formattedTime),1)]),t("td",null,a(n.num),1),t("td",null,a(n.id),1),(r(!0),d(f,null,O(n.products,(h,y)=>(r(),d("td",{key:y},a(h.product.short_title),1))),128)),(r(!0),d(f,null,O(n.products,(h,y)=>(r(),d("td",{key:y},a(h.qty),1))),128)),t("td",null,[Object.values(n.products).some(h=>h.coupon)?(r(),d("span",Te,a(Math.round(n.total)),1)):(r(),d("span",Pe,a(n.calculateTotal),1))]),t("td",null,[n.calculateTotal!==n.total?(r(),d("i",ke)):(r(),d("i",we))]),t("td",{class:w({"text-success":n.is_paid,"text-danger":!n.is_paid})},a(n.is_paid?"已付款":"未付款"),3),Ve,t("td",null,[t("div",De,[t("button",{onClick:h=>i.checkOrder(n),type:"button",class:"btn btn-outline-primary btn-sm"},"查看訂單 ",8,Ee),t("button",{onClick:h=>s.deleteOrder(n.id,s.currentPage),type:"button",class:"btn btn-outline-danger btn-sm"},"刪除 ",8,Ue)])])]))),128))])])]),E(m,{pagination:s.pagination,onGetPages:i.getPages},null,8,["pagination","onGetPages"])])])])}const Ie=S(de,[["render",Le]]);export{Ie as default};
