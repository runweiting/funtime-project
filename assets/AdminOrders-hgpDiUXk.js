import{B as C,D as x,m as L,a as U,_ as S,o as d,c as r,b as t,t as a,e as p,J as j,v as b,F as f,x as g,A,y as w,L as I,M as R,g as T,r as V,d as E}from"./index-8_2dSobz.js";import{s as D}from"./showSuccessToast-NlkLUFHd.js";import{s as O}from"./showErrorToast-RmEj-76d.js";import{t as M}from"./timestampToDate-lwWXufjj.js";import{m as B,P as q}from"./PaginationGroup-e5RmBC5q.js";var G={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:k,VITE_APP_PATH:P}=G,v=C({id:"adminOrdersStore",state:()=>({orderList:[],pagination:{},currentPage:null}),actions:{getOrders(o=1){const e=`${k}/api/${P}/admin/orders?page=${o}`;x.get(e).then(u=>{const{orders:_,pagination:s}=u.data,n=_.map(l=>({...l,calculateTotal:this.updateTotal(l)}));this.orderList=n,this.pagination=s,this.currentPage=o}).catch(u=>{O(u.response.data.message)})},updateTotal(o){if(!o||!o.products)return 0;let e=0;return Object.values(o.products).forEach(u=>{e+=u.qty*u.product.price}),e},deleteOrder(o,e){const u=`${k}/api/${P}/admin/order/${o}`;x.delete(u).then(_=>{D(_.data.message),this.getOrders(e)}).catch(_=>{O(_.response.data.message)})},deleteOrders(){const o=`${k}/api/${P}/admin/orders/all`;x.delete(o).then(e=>{D(e.data.message),this.getOrders()}).catch(e=>{O(e.response.data.message)})}}});var H={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",BASE_URL:"/funtime-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:N,VITE_APP_PATH:F}=H,z={props:{currentOrder:Object},data(){return{orderModal:null,tempOrder:{},inputDisabled:!0,subTotal:0}},mixins:[B],created(){this.tempOrder={...this.currentOrder,products:{},user:{email:"",name:"",tel:"",address:""}}},watch:{currentOrder:{deep:!0,handler(o){this.tempOrder=o}}},computed:{...L(v,["currentPage"])},methods:{...U(v,["getOrders","timestampToDate"]),formatDate(o){const{formattedDay:e,formattedDate:u}=M(o);return{formattedDay:e,formattedDate:u}},togglerEdit(){this.inputDisabled=!1,Object.values(this.tempOrder.products).some(e=>e.coupon&&e.coupon.code)?this.subTotal=0:this.updateSubTotal()},updateSubTotal(){let o=0;Object.values(this.tempOrder.products).forEach(e=>{o+=e.qty*e.product.price}),this.subTotal=o},cancelUpdateOrder(){this.subTotal=0,this.inputDisabled=!0},updateOrder(){const o=`${N}/api/${F}/admin/order/${this.tempOrder.id}`;this.axios.put(o,{data:this.tempOrder}).then(e=>{D(e.data.message),this.subTotal=0,this.inputDisabled=!0,this.modal.hide(),this.getOrders(this.currentPage)}).catch(e=>{O(e.response.data.message)})}}},c=o=>(I("data-v-b2c072fa"),o=o(),R(),o),J={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",ref:"modal"},Q={class:"modal-dialog modal-xl modal-dialog-centered"},K={class:"modal-content"},W={class:"modal-header bg-dark opacity-75 text-white"},X={class:"modal-title",id:"orderModalLabel"},Y=c(()=>t("br",null,null,-1)),Z=c(()=>t("i",{class:"bi bi-x-lg"},null,-1)),$=[Z],tt={class:"modal-body"},et={class:"container-fluid"},st={class:"row mb-5"},ot={class:"border rounded p-2 bg-light"},lt={class:"row mb-2"},dt={class:"col-md-5 d-flex align-items-center gap-3"},rt=c(()=>t("label",{for:"payment",class:"col-form-label"},"付款狀態：",-1)),at=["disabled"],nt=c(()=>t("option",{value:!0}," 已付款 ",-1)),it=c(()=>t("option",{value:!1}," 未付款 ",-1)),ct=[nt,it],ut={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},pt={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},_t={class:"col-md-7"},mt={class:"row"},ht={class:"col-md-5"},bt=c(()=>t("h5",null,"訂購資訊",-1)),ft={class:"row mb-2"},gt=c(()=>t("label",{for:"date",class:"col-sm-3 col-form-label"},"建立時間：",-1)),Ot={class:"col-sm-9"},vt=["disabled"],yt={class:"row mb-2"},xt=c(()=>t("label",{for:"Email",class:"col-sm-3 col-form-label"},"Email：",-1)),Tt={class:"col-sm-9"},kt=["disabled"],Pt={class:"row mb-2"},wt=c(()=>t("label",{for:"name",class:"col-sm-3 col-form-label"},"收件姓名：",-1)),Dt={class:"col-sm-9"},Vt=["disabled"],Et={class:"row mb-2"},Lt=c(()=>t("label",{for:"tel",class:"col-sm-3 col-form-label"},"聯絡電話：",-1)),Ut={class:"col-sm-9"},St=["disabled"],At={class:"row mb-2"},Mt=c(()=>t("label",{for:"address",class:"col-sm-3 col-form-label"},"收件地址：",-1)),Ct={class:"col-sm-9"},jt=["disabled"],It={class:"row mb-2"},Rt=c(()=>t("label",{for:"note",class:"col-sm-3 col-form-label"},"留言：",-1)),Bt={class:"col-sm-9"},qt=["disabled"],Gt={class:"col-md-7"},Ht=c(()=>t("div",{class:"container"},[t("div",{class:"d-flex justify-content-between"},[t("h5",null,"商品內容")])],-1)),Nt={class:"container table-responsive"},Ft={class:"table table-hover align-middle"},zt=c(()=>t("thead",{class:"table-warning"},[t("tr",{class:"align-middle",style:{height:"48px"}},[t("th",{scope:"col",class:"fw-bold",style:{width:"60%"}},"商品"),t("th",{scope:"col",class:"fw-bold",style:{width:"20%"}},"數量"),t("th",{scope:"col",class:"fw-bold text-end",style:{width:"15%"}},"單價"),t("th",{style:{width:"5%"}})])],-1)),Jt={class:"d-flex align-items-center gap-2"},Qt=["src"],Kt=c(()=>t("br",null,null,-1)),Wt={key:0,class:"text-danger"},Xt={class:"pe-0"},Yt={class:"d-flex justify-content-between align-items-center"},Zt={class:"input-group input-group-sm"},$t=["onUpdate:modelValue","disabled"],te={class:"input-group-text"},ee={class:"text-end"},se={class:"fs-6 mb-0"},oe={class:"text-end p-0"},le=["disabled"],de=c(()=>t("td",null,[T(" 原始金額： "),t("br"),T(" 更新金額： "),t("br"),T(" 折扣金額： ")],-1)),re={class:"text-end text-danger fw-bold"},ae=c(()=>t("br",null,null,-1)),ne=c(()=>t("br",null,null,-1)),ie={key:0},ce={key:1,class:"fw-normal text-dark"},ue=c(()=>t("td",null,null,-1)),pe={class:"modal-footer"};function _e(o,e,u,_,s,n){return d(),r("div",J,[t("div",Q,[t("div",K,[t("div",W,[t("h5",X,[t("span",null,"訂單編號："+a(s.tempOrder.id),1),Y]),t("button",{onClick:e[0]||(e[0]=(...l)=>n.cancelUpdateOrder&&n.cancelUpdateOrder(...l)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},$)]),t("div",tt,[t("div",et,[t("div",st,[t("div",ot,[t("div",lt,[t("div",dt,[rt,t("div",null,[p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.tempOrder.is_paid=l),disabled:s.inputDisabled,class:"form-select",id:"payment"},ct,8,at),[[j,s.tempOrder.is_paid]])]),s.tempOrder.is_paid?(d(),r("i",ut)):(d(),r("i",pt))]),t("div",_t,[t("button",{onClick:e[2]||(e[2]=(...l)=>n.togglerEdit&&n.togglerEdit(...l)),type:"button",class:"btn btn-warning"},"修改訂單")])])])]),t("div",mt,[t("div",ht,[bt,t("form",null,[t("div",ft,[gt,t("div",Ot,[p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>n.formatDate(s.tempOrder.create_at).formattedDate=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"date"},null,8,vt),[[b,n.formatDate(s.tempOrder.create_at).formattedDate]])])]),t("div",yt,[xt,t("div",Tt,[p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.tempOrder.user.email=l),disabled:s.inputDisabled,type:"email",class:"form-control",id:"Email"},null,8,kt),[[b,s.tempOrder.user.email]])])]),t("div",Pt,[wt,t("div",Dt,[p(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>s.tempOrder.user.name=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"name"},null,8,Vt),[[b,s.tempOrder.user.name]])])]),t("div",Et,[Lt,t("div",Ut,[p(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.tempOrder.user.tel=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"tel"},null,8,St),[[b,s.tempOrder.user.tel]])])]),t("div",At,[Mt,t("div",Ct,[p(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.tempOrder.user.address=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"address"},null,8,jt),[[b,s.tempOrder.user.address]])])]),t("div",It,[Rt,t("div",Bt,[p(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.tempOrder.user.message=l),disabled:s.inputDisabled,class:"form-control",name:"note",id:"note",cols:"10",rows:"10",style:{height:"100px"}},null,8,qt),[[b,s.tempOrder.user.message]])])])])]),t("div",Gt,[Ht,t("div",Nt,[t("table",Ft,[zt,t("tbody",null,[(d(!0),r(f,null,g(s.tempOrder.products,l=>(d(),r("tr",{key:l.id},[t("td",Jt,[t("img",{src:l.product.imageUrl,class:"rounded order-img"},null,8,Qt),t("div",null,[t("small",null,a(l.product.title),1),Kt,l.coupon?(d(),r("small",Wt,"優惠碼："+a(l.coupon.code)+"、折數："+a(l.coupon.percent)+"%",1)):A("",!0)])]),t("td",Xt,[t("div",Yt,[t("div",Zt,[p(t("input",{"onUpdate:modelValue":m=>l.qty=m,disabled:l.coupon,onClick:e[9]||(e[9]=(...m)=>n.updateSubTotal&&n.updateSubTotal(...m)),type:"number",min:"1",class:"form-control"},null,8,$t),[[b,l.qty]]),t("span",te,a(l.product.unit),1)])])]),t("td",ee,[t("p",se,a(l.product.price)+"元",1)]),t("td",oe,[t("button",{disabled:s.inputDisabled,onClick:e[10]||(e[10]=(...m)=>o.deleteOrder&&o.deleteOrder(...m)),type:"button",class:"btn btn-outline-danger btn-sm py-0",style:{scale:"80%"}}," x ",8,le)])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",null,[t("span",null,a(`總共 ${Object.keys(s.tempOrder.products).length} 項`),1)]),de,t("td",re,[t("span",{class:w({"fw-normal":s.subTotal,"text-dark":s.subTotal,"text-decoration-line-through":s.subTotal})},a(s.tempOrder.calculateTotal)+"元 ",3),ae,t("span",{class:w({"fw-normal":!s.subTotal,"text-dark":!s.subTotal,"text-decoration-line-through":!s.subTotal})},a(s.subTotal)+"元 ",3),ne,Object.values(s.tempOrder.products).some(l=>l.coupon)?(d(),r("span",ie,a(Math.round(s.tempOrder.total))+"元 ",1)):(d(),r("span",ce,"無優惠碼"))]),ue])])])])])])])]),t("div",pe,[t("button",{onClick:e[11]||(e[11]=(...l)=>n.cancelUpdateOrder&&n.cancelUpdateOrder(...l)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{onClick:e[12]||(e[12]=(...l)=>n.updateOrder&&n.updateOrder(...l)),type:"button",class:"btn btn-danger"}," 更新訂單 ")])])])],512)}const me=S(z,[["render",_e],["__scopeId","data-v-b2c072fa"]]),he={components:{OrderModal:me,PaginationGroup:q},data(){return{title:"訂單列表",tempOrderList:[],selectedOrder:{}}},created(){this.tempOrderList=[...this.orderList]},watch:{orderList:{deep:!0,handler(o){this.tempOrderList=o}}},computed:{...L(v,["orderList","calculateTotal","pagination"])},mounted(){this.getOrders()},methods:{...U(v,["getOrders","deleteOrder","deleteOrders","calculateQty"]),getPages(o){this.getOrders(o)},formatDate(o){const{formattedDate:e,formattedTime:u}=M(o);return{formattedDate:e,formattedTime:u}},checkOrder(o){this.selectedOrder={...o},this.$refs.orderModal.openModal()}}},be={class:"container"},fe={class:"row py-2"},ge={class:"col mt-4 mb-4"},Oe={class:"container py-2"},ve=t("h2",null,"這是訂單頁面",-1),ye={class:"d-flex justify-content-between gap-2 py-2"},xe={class:"p-2 mb-0"},Te={class:"d-flex justify-content-end gap-2"},ke={class:"container"},Pe={class:"table table-hover"},we=t("thead",{class:"table-dark"},[t("tr",{class:"fw-bold"},[t("th",{scope:"col"},"日期"),t("th",{scope:"col"},"序號"),t("th",{scope:"col"},"訂單編號"),t("th",{scope:"col"},"品名"),t("th",{scope:"col"},"數量"),t("th",{scope:"col"},"金額"),t("th",{scope:"col"},"優惠卷"),t("th",{scope:"col"},"訂單狀態"),t("th",{scope:"col"},"付款日期"),t("th")])],-1),De={key:0},Ve=t("td",{colspan:"7"},[t("small",{class:"text-muted"}," 目前沒有任何訂單 ")],-1),Ee=[Ve],Le={class:"d-block"},Ue={class:"text-muted"},Se={key:0},Ae={key:1},Me={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},Ce={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},je=t("td",null,null,-1),Ie={class:"btn-group",role:"group"},Re=["onClick"],Be=["onClick"];function qe(o,e,u,_,s,n){const l=V("OrderModal"),m=V("PaginationGroup");return d(),r("main",be,[t("div",fe,[t("main",ge,[t("div",Oe,[ve,t("div",ye,[t("p",xe,a(`一頁顯示 ${Object.keys(this.tempOrderList).length} 項商品`),1),t("div",Te,[t("button",{onClick:e[0]||(e[0]=(...i)=>o.deleteOrders&&o.deleteOrders(...i)),type:"button",class:"btn btn-danger"}," 刪除全部訂單 ")]),E(l,{ref:"orderModal",currentOrder:s.selectedOrder},null,8,["currentOrder"])])]),t("div",ke,[t("table",Pe,[we,t("tbody",null,[s.tempOrderList?A("",!0):(d(),r("tr",De,Ee)),(d(!0),r(f,null,g(s.tempOrderList,i=>(d(),r("tr",{key:i.title},[t("td",null,[t("span",Le,a(n.formatDate(i.create_at).formattedDate),1),t("small",Ue,a(n.formatDate(i.create_at).formattedTime),1)]),t("td",null,a(i.num),1),t("td",null,a(i.id),1),(d(!0),r(f,null,g(i.products,(h,y)=>(d(),r("td",{key:y},a(h.product.short_title),1))),128)),(d(!0),r(f,null,g(i.products,(h,y)=>(d(),r("td",{key:y},a(h.qty),1))),128)),t("td",null,[Object.values(i.products).some(h=>h.coupon)?(d(),r("span",Se,a(Math.round(i.total)),1)):(d(),r("span",Ae,a(i.calculateTotal),1))]),t("td",null,[i.calculateTotal!==i.total?(d(),r("i",Me)):(d(),r("i",Ce))]),t("td",{class:w({"text-success":i.is_paid,"text-danger":!i.is_paid})},a(i.is_paid?"已付款":"未付款"),3),je,t("td",null,[t("div",Ie,[t("button",{onClick:h=>n.checkOrder(i),type:"button",class:"btn btn-outline-primary btn-sm"},"查看訂單 ",8,Re),t("button",{onClick:h=>o.deleteOrder(i.id),type:"button",class:"btn btn-outline-danger btn-sm"},"刪除 ",8,Be)])])]))),128))])])]),E(m,{pagination:o.pagination,onGetPages:n.getPages},null,8,["pagination","onGetPages"])])])])}const Je=S(he,[["render",qe]]);export{Je as default};
